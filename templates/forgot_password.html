{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>InternHub — Forgot Password</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700;9..40,800;9..40,900&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --black:  #0a0a0a;
      --dark:   #141414;
      --panel:  #1a1a1a;
      --mid:    #3d3d3d;
      --subtle: #6b6b6b;
      --muted:  #a0a0a0;
      --light:  #d4d4d4;
      --ghost:  #e8e8e8;
      --off:    #f4f4f4;
      --white:  #fafafa;
      --pure:   #ffffff;
    }

    html, body {
      height: 100%; min-height: 100vh;
      font-family: 'DM Sans', sans-serif;
      background: var(--off); color: var(--black);
      overflow-x: hidden;
    }

    /* ══════════════════════════════════
       LAYOUT: full-height two column
    ══════════════════════════════════ */
    .root {
      display: grid;
      grid-template-columns: 480px 1fr;
      min-height: 100vh;
    }

    /* ══════════════════════════════════
       LEFT — EDITORIAL BLACK PANEL
    ══════════════════════════════════ */
    .left {
      background: var(--black);
      display: flex; flex-direction: column;
      padding: 44px 48px 44px;
      position: relative; overflow: hidden;
    }

    /* Dot-matrix texture */
    .left::before {
      content: '';
      position: absolute; inset: 0;
      background-image: radial-gradient(circle, rgba(255,255,255,.07) 1px, transparent 1px);
      background-size: 28px 28px;
      pointer-events: none;
    }

    /* Corner geometry */
    .geo-ring {
      position: absolute;
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 50%;
      pointer-events: none;
    }
    .geo-ring-1 { width: 560px; height: 560px; bottom: -220px; right: -180px; }
    .geo-ring-2 { width: 360px; height: 360px; bottom: -100px; right: -60px; }
    .geo-ring-3 { width: 180px; height: 180px; bottom: 30px; right: 70px; }

    /* Top bar */
    .left-top {
      display: flex; align-items: center; justify-content: space-between;
      position: relative; z-index: 2;
      animation: fadeUp .45s ease both;
    }
    .logo {
      display: flex; align-items: center; gap: 10px;
    }
    .logo-sq {
      width: 34px; height: 34px; background: var(--white);
      display: flex; align-items: center; justify-content: center;
      font-size: 13px; font-weight: 900; color: var(--black); letter-spacing: -.02em;
      flex-shrink: 0;
    }
    .logo-text { font-size: 17px; font-weight: 800; color: var(--white); letter-spacing: -.03em; }
    .logo-badge {
      font-size: 9px; font-weight: 700; letter-spacing: .1em; text-transform: uppercase;
      color: var(--subtle); border: 1px solid rgba(255,255,255,.1);
      padding: 2px 8px; margin-left: 4px;
    }

    /* Hero section */
    .left-hero {
      flex: 1; display: flex; flex-direction: column; justify-content: center;
      position: relative; z-index: 2; padding: 40px 0 24px;
    }

    .hero-eyebrow {
      display: flex; align-items: center; gap: 10px;
      font-size: 10px; font-weight: 700; letter-spacing: .16em;
      text-transform: uppercase; color: var(--subtle); margin-bottom: 28px;
      animation: fadeUp .45s .06s ease both;
    }
    .hero-eyebrow-line { width: 28px; height: 1px; background: rgba(255,255,255,.15); }

    .hero-headline {
      font-size: clamp(36px, 3.6vw, 54px);
      font-weight: 900; color: var(--white);
      letter-spacing: -.055em; line-height: .98;
      margin-bottom: 22px;
      animation: fadeUp .45s .12s ease both;
    }
    .hero-headline em { font-style: normal; color: rgba(255,255,255,.25); }

    .hero-desc {
      font-size: 13.5px; color: var(--subtle); line-height: 1.75;
      max-width: 310px; margin-bottom: 52px;
      animation: fadeUp .45s .18s ease both;
    }

    /* Big step counter */
    .step-tracker {
      display: flex; flex-direction: column; gap: 0;
      animation: fadeUp .45s .24s ease both;
    }
    .st-item {
      display: flex; align-items: stretch; gap: 20px;
      padding-bottom: 32px; position: relative;
    }
    .st-item:last-child { padding-bottom: 0; }
    .st-left-col {
      display: flex; flex-direction: column; align-items: center; width: 40px;
    }
    .st-num {
      width: 40px; height: 40px; flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      font-size: 14px; font-weight: 800; letter-spacing: -.02em;
      border: 1.5px solid rgba(255,255,255,.1);
      color: rgba(255,255,255,.3);
      transition: all .4s ease;
      position: relative; z-index: 1;
    }
    .st-num.active {
      background: var(--white); color: var(--black);
      border-color: var(--white);
      box-shadow: 0 0 0 6px rgba(255,255,255,.06), 0 0 28px rgba(255,255,255,.1);
    }
    .st-num.done {
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.5);
      border-color: rgba(255,255,255,.15);
    }
    .st-line {
      flex: 1; width: 1px; margin-top: 4px;
      background: linear-gradient(to bottom, rgba(255,255,255,.1), rgba(255,255,255,.02));
    }
    .st-item:last-child .st-line { display: none; }
    .st-body { padding-top: 10px; flex: 1; }
    .st-title {
      font-size: 13.5px; font-weight: 700; color: var(--white);
      letter-spacing: -.01em; margin-bottom: 3px;
      transition: color .3s;
    }
    .st-desc { font-size: 11.5px; color: var(--subtle); line-height: 1.5; }

    /* Left footer */
    .left-footer {
      position: relative; z-index: 2;
      font-size: 11px; color: rgba(255,255,255,.2);
      animation: fadeUp .45s .3s ease both;
    }
    .left-footer a { color: rgba(255,255,255,.3); text-decoration: none; transition: color .15s; }
    .left-footer a:hover { color: rgba(255,255,255,.7); }

    /* ══════════════════════════════════
       RIGHT — FORM AREA
    ══════════════════════════════════ */
    .right {
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      padding: 56px 48px; background: var(--off);
      position: relative;
    }

    /* Subtle corner texture */
    .right::after {
      content: '';
      position: absolute; bottom: 0; right: 0;
      width: 220px; height: 220px;
      background-image: radial-gradient(circle, rgba(0,0,0,.05) 1px, transparent 1px);
      background-size: 16px 16px;
      pointer-events: none;
    }

    /* Back link */
    .back-link {
      position: absolute; top: 32px; left: 40px;
      display: inline-flex; align-items: center; gap: 8px;
      font-size: 12px; font-weight: 600; color: var(--muted);
      text-decoration: none; transition: color .2s;
      z-index: 10;
      animation: fadeUp .4s ease both;
    }
    .back-link svg { transition: transform .2s; flex-shrink: 0; }
    .back-link:hover { color: var(--black); }
    .back-link:hover svg { transform: translateX(-3px); }

    /* Card */
    .card {
      width: 100%; max-width: 420px;
      background: var(--pure);
      border: 1px solid var(--ghost);
      box-shadow:
        0 1px 2px rgba(0,0,0,.04),
        0 4px 12px rgba(0,0,0,.05),
        0 20px 60px rgba(0,0,0,.08);
      position: relative; z-index: 2;
      animation: fadeUp .45s .08s ease both;
      overflow: hidden;
    }

    /* Progress rail at very top of card */
    .card-rail {
      display: flex; gap: 0; height: 3px;
      background: var(--ghost);
    }
    .rail-seg {
      height: 100%; flex: 1;
      background: var(--ghost);
      transition: background .5s ease;
      transform-origin: left;
    }
    .rail-seg.active { background: var(--black); }
    .rail-seg.done   { background: var(--mid); }

    .card-body { padding: 36px 36px 32px; }

    /* Step label */
    .step-label {
      display: flex; align-items: center; gap: 8px;
      margin-bottom: 18px;
    }
    .step-label-num {
      font-size: 9.5px; font-weight: 800; letter-spacing: .12em;
      text-transform: uppercase; color: var(--black);
      background: var(--off); border: 1px solid var(--ghost);
      padding: 3px 9px;
    }
    .step-label-sep { width: 20px; height: 1px; background: var(--ghost); }
    .step-label-text { font-size: 9.5px; font-weight: 600; letter-spacing: .08em; text-transform: uppercase; color: var(--muted); }

    .form-title {
      font-size: 26px; font-weight: 900; color: var(--black);
      letter-spacing: -.05em; line-height: 1.1; margin-bottom: 8px;
    }
    .form-sub {
      font-size: 13px; color: var(--muted); line-height: 1.65;
      margin-bottom: 28px;
    }
    .form-sub strong { color: var(--dark); font-weight: 600; }

    /* ── PANELS ── */
    .panel { display: none; }
    .panel.active { display: block; animation: slideIn .3s cubic-bezier(.22,.68,0,1.2) both; }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(14px); }
      to   { opacity: 1; transform: translateX(0); }
    }

    /* Fields */
    .f-group { display: flex; flex-direction: column; gap: 7px; margin-bottom: 16px; }
    .f-label {
      font-size: 10px; font-weight: 800; color: var(--mid);
      letter-spacing: .09em; text-transform: uppercase;
    }
    .f-input-wrap { position: relative; }
    .f-input {
      width: 100%; height: 48px; padding: 0 16px;
      background: var(--off); border: 1.5px solid var(--ghost);
      font-family: 'DM Sans', sans-serif; font-size: 14px; color: var(--black);
      outline: none; transition: border-color .2s, background .2s, box-shadow .2s;
    }
    .f-input::placeholder { color: var(--light); font-weight: 400; }
    .f-input:hover { border-color: var(--light); background: var(--white); }
    .f-input:focus {
      border-color: var(--black); background: var(--pure);
      box-shadow: 4px 4px 0 rgba(0,0,0,.05);
    }
    .f-icon {
      position: absolute; right: 14px; top: 50%;
      transform: translateY(-50%); color: var(--ghost); pointer-events: none;
    }

    /* OTP */
    .otp-row { display: flex; gap: 8px; margin-bottom: 10px; }
    .otp-input {
      flex: 1; height: 62px; width:30px;
      text-align: center; font-size: 26px; font-weight: 900; letter-spacing: -.03em;
      background: var(--off); border: 1.5px solid var(--ghost);
      font-family: 'DM Sans', sans-serif; color: var(--black);
      outline: none; transition: all .2s; caret-color: transparent;
    }
    .otp-input:focus {
      border-color: var(--black); background: var(--pure);
      box-shadow: 4px 4px 0 rgba(0,0,0,.05);
    }
    .otp-input.filled {
      border-color: var(--black); background: var(--pure);
      color: var(--black);
    }

    /* Resend */
    .resend-row {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 22px;
    }
    .resend-countdown { font-size: 12px; color: var(--muted); }
    .resend-countdown strong { color: var(--mid); font-weight: 700; }
    .resend-btn {
      font-size: 12px; font-weight: 700; color: var(--black);
      background: none; border: none; cursor: pointer;
      display: inline-flex; align-items: center; gap: 5px;
      text-decoration: underline; text-underline-offset: 3px; transition: opacity .15s;
    }
    .resend-btn:disabled { opacity: .3; cursor: not-allowed; text-decoration: none; }

    /* Password strength */
    .pw-track {
      display: flex; gap: 4px; margin-top: 8px; margin-bottom: 5px;
    }
    .pw-bar-seg {
      flex: 1; height: 3px; background: var(--ghost); transition: background .35s ease;
    }
    .pw-bar-seg.on { background: var(--black); }
    .pw-str-label { font-size: 11px; color: var(--muted); font-weight: 600; margin-top: 2px; display: block; }
    .pw-str-label.weak   { color: var(--muted); }
    .pw-str-label.fair   { color: var(--mid); }
    .pw-str-label.strong { color: var(--black); }

    /* Requirements */
    .req-box {
      background: var(--off); border: 1px solid var(--ghost);
      padding: 14px 16px; margin-bottom: 18px;
    }
    .req-head {
      font-size: 9px; font-weight: 800; letter-spacing: .12em;
      text-transform: uppercase; color: var(--muted); margin-bottom: 11px;
    }
    .req-item {
      display: flex; align-items: center; gap: 9px;
      font-size: 12px; color: var(--muted); margin-bottom: 7px;
      transition: color .25s;
    }
    .req-item:last-child { margin-bottom: 0; }
    .req-item.met { color: var(--black); }
    .req-check {
      width: 17px; height: 17px; flex-shrink: 0;
      border: 1.5px solid var(--ghost);
      display: flex; align-items: center; justify-content: center;
      transition: all .25s;
    }
    .req-item.met .req-check {
      background: var(--black); border-color: var(--black);
    }

    /* Messages */
    .msg {
      display: none; padding: 11px 14px; margin-bottom: 14px;
      font-size: 12.5px; font-weight: 500;
      border-left: 3px solid var(--black);
      background: var(--off); color: var(--mid);
    }
    .msg.show { display: flex; align-items: center; gap: 9px; animation: fadeUp .25s ease both; }
    .msg.error { border-left-color: #c0392b; background: #fff5f5; color: #922b21; }
    .msg.success { border-left-color: var(--black); }

    /* Submit button */
    .submit-btn {
      width: 100%; height: 50px;
      background: var(--black); color: var(--white);
      border: none; font-family: 'DM Sans', sans-serif;
      font-size: 13.5px; font-weight: 800; letter-spacing: -.01em;
      cursor: pointer; transition: all .22s;
      display: flex; align-items: center; justify-content: center; gap: 10px;
      position: relative; overflow: hidden; margin-top: 6px;
    }
    .submit-btn::after {
      content: ''; position: absolute; inset: 0;
      background: var(--panel);
      transform: scaleX(0); transform-origin: left;
      transition: transform .3s cubic-bezier(.22,.68,0,1);
    }
    .submit-btn:hover::after { transform: scaleX(1); }
    .submit-btn span,
    .submit-btn svg { position: relative; z-index: 1; flex-shrink: 0; }
    .submit-btn:hover { box-shadow: 6px 6px 0 rgba(0,0,0,.12); transform: translate(-2px, -2px); }
    .submit-btn:active { transform: translate(0,0); box-shadow: none; }
    .submit-btn:disabled { opacity: .4; cursor: not-allowed; transform: none; box-shadow: none; }

    /* Eye toggle */
    .eye-btn {
      position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
      background: none; border: none; cursor: pointer;
      color: var(--light); padding: 0; display: flex; transition: color .15s;
    }
    .eye-btn:hover { color: var(--mid); }

    /* ── SUCCESS ── */
    .success-inner {
      display: flex; flex-direction: column; align-items: center;
      text-align: center; padding: 8px 0 4px;
    }
    .success-badge {
      width: 72px; height: 72px;
      background: var(--black);
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 24px; position: relative;
    }
    .success-badge::before {
      content: '';
      position: absolute; inset: -9px;
      border: 1.5px solid var(--ghost);
    }
    .success-badge::after {
      content: '';
      position: absolute; inset: -18px;
      border: 1px solid var(--off);
    }
    .success-title {
      font-size: 24px; font-weight: 900; letter-spacing: -.05em;
      color: var(--black); margin-bottom: 10px;
    }
    .success-desc {
      font-size: 13px; color: var(--muted); line-height: 1.7;
      max-width: 260px; margin-bottom: 30px;
    }
    .go-login {
      display: inline-flex; align-items: center; gap: 9px;
      height: 50px; padding: 0 34px;
      background: var(--black); color: var(--white);
      text-decoration: none; font-size: 13.5px; font-weight: 800;
      letter-spacing: -.01em; transition: all .22s; position: relative; overflow: hidden;
    }
    .go-login::after {
      content: ''; position: absolute; inset: 0; background: var(--panel);
      transform: scaleX(0); transform-origin: left;
      transition: transform .3s cubic-bezier(.22,.68,0,1);
    }
    .go-login:hover::after { transform: scaleX(1); }
    .go-login span, .go-login svg { position: relative; z-index: 1; }
    .go-login:hover { box-shadow: 6px 6px 0 rgba(0,0,0,.12); transform: translate(-2px,-2px); }

    /* ── ANIMATIONS ── */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(14px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ── RESPONSIVE ── */
    @media(max-width: 860px) {
      .root { grid-template-columns: 1fr; }
      .left  { display: none; }
      .right { padding: 64px 20px 40px; }
      .back-link { top: 20px; left: 20px; }
      .card-body { padding: 28px 22px 24px; }
    }

    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: var(--off); }
    ::-webkit-scrollbar-thumb { background: var(--ghost); }
  </style>
</head>
<body>
<div class="root">

  <!-- ════════════ LEFT ════════════ -->
  <div class="left">
    <div class="geo-ring geo-ring-1"></div>
    <div class="geo-ring geo-ring-2"></div>
    <div class="geo-ring geo-ring-3"></div>

    <div class="left-top">
      <div class="logo">
        <div class="logo-sq">IH</div>
        <span class="logo-text">InternHub</span>
        <span class="logo-badge">Beta</span>
      </div>
    </div>

    <div class="left-hero">
      <div class="hero-eyebrow">
        <span class="hero-eyebrow-line"></span>
        Password Recovery
      </div>

      <h1 class="hero-headline">
        Reset in<br>3 simple<br><em>steps.</em>
      </h1>

      <p class="hero-desc">
        Enter your email, verify the code we send, and set a fresh password — done in under a minute.
      </p>

      <div class="step-tracker">
        <div class="st-item">
          <div class="st-left-col">
            <div class="st-num active" id="ls-1">1</div>
            <div class="st-line"></div>
          </div>
          <div class="st-body">
            <div class="st-title">Enter your email</div>
            <div class="st-desc">We verify it's really you.</div>
          </div>
        </div>
        <div class="st-item">
          <div class="st-left-col">
            <div class="st-num" id="ls-2">2</div>
            <div class="st-line"></div>
          </div>
          <div class="st-body">
            <div class="st-title">Verify OTP</div>
            <div class="st-desc">6-digit code sent to your inbox.</div>
          </div>
        </div>
        <div class="st-item">
          <div class="st-left-col">
            <div class="st-num" id="ls-3">3</div>
          </div>
          <div class="st-body">
            <div class="st-title">Set new password</div>
            <div class="st-desc">Choose strong, finish fast.</div>
          </div>
        </div>
      </div>
    </div>

    <div class="left-footer">
      © 2026 InternHub &nbsp;·&nbsp; <a href="#">Privacy</a> &nbsp;·&nbsp; <a href="#">Terms</a>
    </div>
  </div>

  <!-- ════════════ RIGHT ════════════ -->
  <div class="right">
    <a href="{% url 'login' %}" class="back-link">
      <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
        <path stroke-linecap="round" d="M19 12H5M12 5l-7 7 7 7"/>
      </svg>
      Back to login
    </a>

    <div class="card">
      <!-- Progress rail -->
      <div class="card-rail">
        <div class="rail-seg active" id="rail-1"></div>
        <div class="rail-seg" id="rail-2"></div>
        <div class="rail-seg" id="rail-3"></div>
      </div>

      <div class="card-body">

        <!-- ══ STEP 1: Email ══ -->
        <div class="panel active" id="panel-1">
          <div class="step-label">
            <span class="step-label-num">Step 01</span>
            <span class="step-label-sep"></span>
            <span class="step-label-text">of 3</span>
          </div>
          <div class="form-title">Forgot your<br>password?</div>
          <p class="form-sub">No worries — enter your registered email and we'll send you a verification code right away.</p>

          <div id="msg-1" class="msg"></div>

          <form onsubmit="submitEmail(event)">
            <div class="f-group">
              <label class="f-label">Email Address</label>
              <div class="f-input-wrap">
                <input class="f-input" type="email" id="email-input"
                       placeholder="you@university.edu" required autocomplete="email"
                       style="padding-right:44px">
                <span class="f-icon">
                  <svg width="15" height="15" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                    <path stroke-linecap="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                  </svg>
                </span>
              </div>
            </div>
            <button type="submit" class="submit-btn" id="btn-1">
              <span>Send OTP Code</span>
              <svg width="15" height="15" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
            </button>
          </form>
        </div>

        <!-- ══ STEP 2: OTP ══ -->
        <div class="panel" id="panel-2">
          <div class="step-label">
            <span class="step-label-num">Step 02</span>
            <span class="step-label-sep"></span>
            <span class="step-label-text">of 3</span>
          </div>
          <div class="form-title">Enter the<br>OTP code</div>
          <p class="form-sub">Code sent to <strong id="otp-email-display">—</strong></p>

          <div id="msg-2" class="msg"></div>

          <div class="otp-row">
            <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]">
            <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]">
            <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]">
            <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]">
            <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]">
            <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]">
          </div>

          <div class="resend-row">
            <span class="resend-countdown" id="resend-timer">
              Resend in <strong id="countdown">60</strong>s
            </span>
            <button class="resend-btn" id="resend-btn" disabled onclick="resendOtp()">
              <svg width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
              </svg>
              Resend code
            </button>
          </div>

          <button class="submit-btn" id="btn-2" onclick="verifyOtp()" disabled>
            <span>Verify Code</span>
            <svg width="15" height="15" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
              <path stroke-linecap="round" d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </button>
        </div>

        <!-- ══ STEP 3: New Password ══ -->
        <div class="panel" id="panel-3">
          <div class="step-label">
            <span class="step-label-num">Step 03</span>
            <span class="step-label-sep"></span>
            <span class="step-label-text">of 3</span>
          </div>
          <div class="form-title">Set a new<br>password</div>
          <p class="form-sub">Make it strong. You can't reuse your last 3 passwords.</p>

          <div id="msg-3" class="msg"></div>

          <form onsubmit="submitNewPassword(event)">
            <div class="f-group">
              <label class="f-label">New Password</label>
              <div class="f-input-wrap">
                <input class="f-input" type="password" id="new-pw"
                       placeholder="Min. 8 characters" style="padding-right:48px"
                       oninput="checkStrength(this.value)" required>
                <button type="button" class="eye-btn" onclick="togglePw(this)" tabindex="-1">
                  <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                    <path stroke-linecap="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                  </svg>
                </button>
              </div>
              <div class="pw-track">
                <div class="pw-bar-seg" id="ps1"></div>
                <div class="pw-bar-seg" id="ps2"></div>
                <div class="pw-bar-seg" id="ps3"></div>
              </div>
              <span class="pw-str-label" id="pw-label"></span>
            </div>

            <div class="f-group">
              <label class="f-label">Confirm Password</label>
              <div class="f-input-wrap">
                <input class="f-input" type="password" id="confirm-pw"
                       placeholder="Re-enter new password" style="padding-right:48px" required>
                <button type="button" class="eye-btn" onclick="togglePw(this)" tabindex="-1">
                  <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                    <path stroke-linecap="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                  </svg>
                </button>
              </div>
            </div>

            <div class="req-box">
              <div class="req-head">Password Requirements</div>
              <div class="req-item" id="req-len">
                <span class="req-check">
                  <svg width="9" height="9" fill="none" viewBox="0 0 24 24" stroke="white" stroke-width="3.5"><path stroke-linecap="round" d="M5 13l4 4L19 7"/></svg>
                </span>
                At least 8 characters
              </div>
              <div class="req-item" id="req-upper">
                <span class="req-check">
                  <svg width="9" height="9" fill="none" viewBox="0 0 24 24" stroke="white" stroke-width="3.5"><path stroke-linecap="round" d="M5 13l4 4L19 7"/></svg>
                </span>
                One uppercase letter
              </div>
              <div class="req-item" id="req-num">
                <span class="req-check">
                  <svg width="9" height="9" fill="none" viewBox="0 0 24 24" stroke="white" stroke-width="3.5"><path stroke-linecap="round" d="M5 13l4 4L19 7"/></svg>
                </span>
                One number or special character
              </div>
            </div>

            <button type="submit" class="submit-btn" id="btn-3">
              <span>Reset Password</span>
              <svg width="15" height="15" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
            </button>
          </form>
        </div>

        <!-- ══ SUCCESS ══ -->
        <div class="panel" id="panel-success">
          <div class="success-inner">
            <div class="success-badge">
              <svg width="30" height="30" fill="none" viewBox="0 0 24 24" stroke="white" stroke-width="2.5">
                <path stroke-linecap="round" d="M5 13l4 4L19 7"/>
              </svg>
            </div>
            <div class="success-title">All done!</div>
            <p class="success-desc">Your password has been successfully reset. You can now sign in with your new credentials.</p>
            <a href="{% url 'login_user' %}" class="go-login">
              <span>Sign in now</span>
              <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
            </a>
          </div>
        </div>

      </div><!-- /card-body -->
    </div><!-- /card -->
  </div><!-- /right -->
</div><!-- /root -->

<script>
  let timer = null;

  /* ────────────────────────────────────
     STEP NAVIGATION
  ──────────────────────────────────── */
  function goToStep(n) {
    // Panels
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.getElementById(n === 4 ? 'panel-success' : 'panel-' + n).classList.add('active');

    // Rail
    ['rail-1','rail-2','rail-3'].forEach((id, i) => {
      const seg = document.getElementById(id);
      seg.className = 'rail-seg';
      if (n === 4 || i + 1 < n) seg.classList.add('done');
      else if (i + 1 === n)     seg.classList.add('active');
    });

    // Left step indicators
    [1,2,3].forEach(i => {
      const el = document.getElementById('ls-' + i);
      el.className = 'st-num';
      if (i < n || (i === n && n < 4)) {
        el.classList.add(i < n ? 'done' : 'active');
        el.style.opacity = '1';
      } else {
        el.style.opacity = '.25';
      }
    });
  }

  /* ────────────────────────────────────
     STEP 1 — EMAIL
  ──────────────────────────────────── */
  function submitEmail(e) {
    e.preventDefault();
    const email = document.getElementById('email-input').value.trim();
    const btn   = document.getElementById('btn-1');
    setLoading(btn, true, 'Sending…');

    // → Replace with: fetch('/send-otp/', { method:'POST', ... })
    setTimeout(() => {
      setLoading(btn, false, 'Send OTP Code');
      document.getElementById('otp-email-display').textContent = email;
      goToStep(2);
      setupOtp();
      startCountdown();
    }, 1300);
  }

  /* ────────────────────────────────────
     STEP 2 — OTP
  ──────────────────────────────────── */
  function setupOtp() {
    const inputs = document.querySelectorAll('.otp-input');

    // Clone to remove old listeners
    inputs.forEach(inp => {
      const c = inp.cloneNode(true);
      inp.parentNode.replaceChild(c, inp);
    });

    const fresh = document.querySelectorAll('.otp-input');
    fresh.forEach((inp, i) => {
      inp.value = ''; inp.className = 'otp-input';

      inp.addEventListener('input', () => {
        inp.value = inp.value.replace(/\D/, '').slice(0, 1);
        inp.classList.toggle('filled', !!inp.value);
        if (inp.value && i < fresh.length - 1) fresh[i + 1].focus();
        checkComplete();
      });

      inp.addEventListener('keydown', e => {
        if (e.key === 'Backspace' && !inp.value && i > 0) fresh[i - 1].focus();
      });

      inp.addEventListener('paste', e => {
        e.preventDefault();
        const data = (e.clipboardData || window.clipboardData).getData('text').replace(/\D/g,'').slice(0,6);
        data.split('').forEach((ch, j) => {
          if (fresh[j]) { fresh[j].value = ch; fresh[j].classList.add('filled'); }
        });
        fresh[Math.min(data.length, 5)].focus();
        checkComplete();
      });
    });

    fresh[0].focus();
  }

  function checkComplete() {
    const done = Array.from(document.querySelectorAll('.otp-input')).every(i => i.value.length === 1);
    document.getElementById('btn-2').disabled = !done;
  }

  function startCountdown() {
    let s = 60;
    if (timer) clearInterval(timer);
    document.getElementById('countdown').textContent = s;
    document.getElementById('resend-btn').disabled = true;
    document.getElementById('resend-timer').style.display = 'inline';

    timer = setInterval(() => {
      s--;
      document.getElementById('countdown').textContent = s;
      if (s <= 0) {
        clearInterval(timer);
        document.getElementById('resend-btn').disabled = false;
        document.getElementById('resend-timer').style.display = 'none';
      }
    }, 1000);
  }

  function resendOtp() {
    document.getElementById('btn-2').disabled = true;
    setupOtp();
    startCountdown();
    showMsg('msg-2', 'A new code has been sent.', 'success');
  }

  function verifyOtp() {
    const otp = Array.from(document.querySelectorAll('.otp-input')).map(i => i.value).join('');
    const btn  = document.getElementById('btn-2');
    setLoading(btn, true, 'Verifying…');

    // → Replace with: fetch('/verify-otp/', { method:'POST', ... })
    setTimeout(() => {
      setLoading(btn, false, 'Verify Code');
      if (otp === '000000') {
        showMsg('msg-2', 'Incorrect code. Please try again.', 'error');
        btn.disabled = false;
      } else {
        goToStep(3);
      }
    }, 1000);
  }

  /* ────────────────────────────────────
     STEP 3 — NEW PASSWORD
  ──────────────────────────────────── */
  function checkStrength(v) {
    const hasLen   = v.length >= 8;
    const hasUpper = /[A-Z]/.test(v);
    const hasNum   = /[0-9!@#$%^&*]/.test(v);
    const score    = [hasLen, hasUpper, hasNum].filter(Boolean).length;

    setReq('req-len',   hasLen);
    setReq('req-upper', hasUpper);
    setReq('req-num',   hasNum);

    ['ps1','ps2','ps3'].forEach((id, i) => {
      document.getElementById(id).className = 'pw-bar-seg' + (score > i ? ' on' : '');
    });

    const lbl = document.getElementById('pw-label');
    const states = ['', 'Weak', 'Fair', 'Strong'];
    const classes = ['', 'weak', 'fair', 'strong'];
    lbl.textContent = v.length ? states[score] : '';
    lbl.className   = 'pw-str-label ' + (v.length ? classes[score] : '');
  }

  function setReq(id, met) {
    document.getElementById(id).classList.toggle('met', met);
  }

  function submitNewPassword(e) {
    e.preventDefault();
    const pw  = document.getElementById('new-pw').value;
    const cpw = document.getElementById('confirm-pw').value;
    const btn = document.getElementById('btn-3');

    if (pw.length < 8) { showMsg('msg-3', 'Password must be at least 8 characters.', 'error'); return; }
    if (pw !== cpw)    { showMsg('msg-3', 'Passwords do not match.', 'error'); return; }

    setLoading(btn, true, 'Resetting…');

    // → Replace with: fetch('/reset-password/', { method:'POST', ... })
    setTimeout(() => {
      setLoading(btn, false, 'Reset Password');
      goToStep(4);
    }, 1200);
  }

  /* ────────────────────────────────────
     HELPERS
  ──────────────────────────────────── */
  function setLoading(btn, on, label) {
    btn.disabled = on;
    btn.querySelector('span').textContent = label;
  }

  function showMsg(id, text, type) {
    const box = document.getElementById(id);
    const icon = type === 'error'
      ? `<svg style="flex-shrink:0" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path stroke-linecap="round" d="M12 8v4m0 4h.01"/></svg>`
      : `<svg style="flex-shrink:0" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" d="M5 13l4 4L19 7"/></svg>`;
    box.innerHTML = icon + `<span>${text}</span>`;
    box.className = `msg show ${type}`;
    setTimeout(() => box.classList.remove('show'), 4500);
  }

  function togglePw(btn) {
    const inp    = btn.previousElementSibling;
    const hidden = inp.type === 'password';
    inp.type = hidden ? 'text' : 'password';
    btn.querySelector('svg').innerHTML = hidden
      ? `<path stroke-linecap="round" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>`
      : `<path stroke-linecap="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>`;
  }

  // Init left step states
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('ls-2').style.opacity = '.25';
    document.getElementById('ls-3').style.opacity = '.25';
  });
</script>
</body>
</html>