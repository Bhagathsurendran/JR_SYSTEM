{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>InternHub — Admin Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700;9..40,800;9..40,900&display=swap" rel="stylesheet">
<style>
    .bar { position:relative; display:inline-block; margin:0 8px; width:10px; height:50px; border-radius:0; background:#fff; box-shadow:0 4px 10px rgba(47,47,47,.3); animation:swing infinite 5s cubic-bezier(.955,-0.01,1,1); transform-origin:100% 100%; }
    .bar::before { content:""; position:absolute; z-index:-1; bottom:0; display:block; width:10px; height:10px; background:transparent; box-shadow:0 4px rgba(29,29,29,.3); animation:extend infinite 5s cubic-bezier(.955,-0.01,1,1); opacity:0; transform-origin:0% 0%; }
    .bar:nth-child(2),.bar:nth-child(2)::before{animation-delay:.3s}
    .bar:nth-child(3),.bar:nth-child(3)::before{animation-delay:.6s}
    .bar:nth-child(4),.bar:nth-child(4)::before{animation-delay:.9s}
    .bar:nth-child(5),.bar:nth-child(5)::before{animation-delay:1.2s}
    .bar:last-of-type{animation-name:swing-last}
    .bar:last-of-type::before{animation-name:extend-last}
    @keyframes swing{10%{transform:rotate(70deg)}60%{transform:rotate(70deg)}70%{transform:rotate(0deg)}}
    @keyframes swing-last{10%{transform:rotate(90deg)}60%{transform:rotate(90deg)}70%{transform:rotate(0deg)}}
    @keyframes extend{10%{transform:rotate(-70deg);width:20px;opacity:1;left:0;bottom:-1px}60%{transform:rotate(-70deg);width:20px;opacity:1}70%{width:10px;transform:rotate(0deg);opacity:0}}
    @keyframes extend-last{10%{transform:rotate(-90deg);width:20px;height:2px;opacity:.5;left:3px;bottom:-1px}60%{transform:rotate(-90deg);width:20px;height:2px;opacity:.5}70%{transform:rotate(0deg);width:10px;height:10px;opacity:0}}
    .bars-loader{position:relative;display:block;margin:auto;padding:0;width:150px;height:50px;text-align:center}

    #page-loader{position:fixed;inset:0;background:#0a0a0a;z-index:9999;display:flex;align-items:center;justify-content:center}

    .loader{width:28px;height:28px;border:3px solid #e5e5e5;border-top:3px solid #000;border-radius:50%;margin:40px auto;animation:spin .8s linear infinite}
    @keyframes spin{100%{transform:rotate(360deg)}}

    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
        --black:#0a0a0a;--near-black:#111;--dark:#1a1a1a;--mid:#3d3d3d;
        --subtle:#6b6b6b;--muted:#a0a0a0;--light:#d4d4d4;
        --ghost:#ebebeb;--off:#f5f5f5;--white:#fafafa;--pure:#fff;
        --sidebar-w:224px;--nav-h:60px;
    }
    body{font-family:'DM Sans',sans-serif;background:var(--white);color:var(--black);min-height:100vh;overflow-x:hidden}

    /* SIDEBAR */
    .sidebar{position:fixed;left:0;top:0;bottom:0;width:var(--sidebar-w);background:var(--black);display:flex;flex-direction:column;z-index:200;border-right:1px solid #1f1f1f;transition:transform .3s ease}
    .sidebar-logo{display:flex;align-items:center;gap:10px;padding:22px 24px 20px;border-bottom:1px solid #1c1c1c;flex-shrink:0}
    .logo-mark{width:28px;height:28px;background:var(--white);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:900;color:var(--black);flex-shrink:0}
    .logo-name{font-size:15.5px;font-weight:700;color:var(--white);letter-spacing:-.02em}
    .logo-pill{margin-left:auto;font-size:9px;font-weight:600;border:1px solid var(--subtle);color:var(--muted);padding:2px 6px;text-transform:uppercase;letter-spacing:.05em}
    .nav-label{padding:20px 24px 7px;font-size:9px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--subtle)}
    .nav-item{display:flex;align-items:center;gap:11px;padding:10px 24px;cursor:pointer;font-size:13px;font-weight:400;color:var(--muted);transition:all .15s;border:none;background:none;width:100%;text-align:left}
    .nav-item:hover{color:var(--white);background:#181818}
    .nav-item.active{color:var(--white);font-weight:600;background:var(--near-black);border-left:2px solid var(--white);padding-left:22px}
    .nav-item svg{flex-shrink:0;opacity:.55}
    .nav-item.active svg,.nav-item:hover svg{opacity:1}
    .nb{margin-left:auto;min-width:20px;height:18px;font-size:10px;font-weight:700;display:flex;align-items:center;justify-content:center;padding:0 6px;border-radius:20px}
    .nb-mid{background:var(--mid);color:var(--white)}
    .nb-dk{background:#222;color:#888}

    /* SIDEBAR FOOTER */
    .sidebar-footer{margin-top:auto;border-top:1px solid #1c1c1c;position:relative;flex-shrink:0}
    .profile-popup{position:absolute;bottom:100%;left:0;right:0;background:#0f0f0f;border:1px solid #1c1c1c;border-bottom:none;overflow:hidden;max-height:0;opacity:0;transform:translateY(6px);transition:max-height .25s ease,opacity .2s ease,transform .2s ease;pointer-events:none}
    .sidebar-footer:hover .profile-popup,.sidebar-footer:focus-within .profile-popup{max-height:200px;opacity:1;transform:translateY(0);pointer-events:all}
    .popup-item{display:flex;align-items:center;gap:10px;padding:12px 20px;font-size:13px;font-weight:500;color:var(--muted);cursor:pointer;border:none;background:none;width:100%;text-align:left;transition:all .15s;border-bottom:1px solid #1c1c1c}
    .popup-item:last-child{border-bottom:none}
    .popup-item:hover{background:#1a1a1a;color:var(--white)}
    .popup-item svg{flex-shrink:0;opacity:.6}
    .popup-item:hover svg{opacity:1}
    .popup-item.danger{color:#f87171}
    .popup-item.danger:hover{background:rgba(248,113,113,.07);color:#fca5a5}
    .popup-item.active-page{color:var(--white);background:#1c1c1c;font-weight:600}
    .user-tile{display:flex;align-items:center;gap:11px;padding:15px 20px;cursor:pointer;transition:background .15s}
    .sidebar-footer:hover .user-tile{background:#161616}
    .u-av{background:#252525;border:1px solid #333;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#aaa;flex-shrink:0}
    .u-name-s{font-size:12.5px;font-weight:600;color:var(--white);line-height:1.2}
    .u-role-s{font-size:10px;color:var(--subtle);margin-top:1px}
    .u-chev{margin-left:auto;color:var(--subtle);transition:transform .2s}
    .sidebar-footer:hover .u-chev{transform:rotate(180deg);color:var(--muted)}

    /* TOPNAV */
    .topnav{position:fixed;top:0;left:var(--sidebar-w);right:0;height:var(--nav-h);background:var(--pure);border-bottom:1px solid var(--ghost);display:flex;align-items:center;padding:0 32px;gap:14px;z-index:100}
    .search-bar{display:flex;align-items:center;gap:9px;background:var(--off);border:1px solid var(--ghost);padding:9px 14px;flex:1;max-width:380px;transition:all .2s}
    .search-bar:focus-within{border-color:var(--black);background:var(--pure)}
    .search-bar input{border:none;background:transparent;outline:none;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--black);width:100%}
    .search-bar input::placeholder{color:var(--muted)}
    .tnav-r{margin-left:auto;display:flex;align-items:center;gap:10px}
    .ico-btn{width:36px;height:36px;border:none;background:transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--mid);transition:background .15s;position:relative}
    .ico-btn:hover{background:var(--off)}
    .notif-dot{position:absolute;top:7px;right:7px;width:6px;height:6px;background:var(--black);border:2px solid var(--pure);border-radius:50%}
    .btn{display:inline-flex;align-items:center;gap:7px;height:36px;padding:0 18px;font-family:'DM Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;border:none;transition:all .15s}
    .btn-dark{background:var(--black);color:var(--white)}
    .btn-dark:hover{background:var(--dark)}
    .btn-outline{background:var(--pure);color:var(--black);border:1px solid var(--light)}
    .btn-outline:hover{background:var(--off)}
    .btn-ghost{background:transparent;color:var(--mid);border:1px solid var(--ghost)}
    .btn-ghost:hover{border-color:var(--light);color:var(--black)}
    .btn-danger{background:#ef4444;color:#fff;border:none}
    .btn-danger:hover{background:#dc2626}
    .hamburger{display:none}

    /* LAYOUT */
    .main{margin-left:var(--sidebar-w);padding-top:var(--nav-h);min-height:100vh}
    .page{display:none;padding:40px 40px 72px;animation:fadeUp .22s ease both}
    .page.active{display:block}
    @keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    /* PAGE HEADER */
    .ph{display:flex;align-items:flex-start;justify-content:space-between;gap:16px;flex-wrap:wrap;margin-bottom:36px;padding-bottom:28px;border-bottom:1px solid var(--ghost)}
    .ph-title{font-size:clamp(28px,3vw,42px);font-weight:900;letter-spacing:-.04em;color:var(--black);line-height:1.05}
    .ph-sub{font-size:12px;color:var(--muted);margin-top:7px}

    /* STAT CARDS */
    .stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:0;margin-bottom:36px;border:1px solid var(--ghost);background:var(--ghost)}
    .stat-card{background:var(--pure);padding:30px 30px 26px;transition:background .2s}
    .stat-card:hover{background:var(--off)}
    .stat-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .stat-lbl{font-size:10px;font-weight:700;text-transform:uppercase;color:var(--muted);letter-spacing:.06em}
    .stat-pill{font-size:10px;font-weight:700;padding:3px 9px}
    .pill-dk{background:var(--black);color:var(--white)}
    .pill-gh{background:var(--off);color:var(--subtle);border:1px solid var(--ghost)}
    .stat-val{font-size:48px;font-weight:900;letter-spacing:-.05em;color:var(--black);line-height:1}

    /* ═══ OVERVIEW GRID — FIXED ALIGNMENT ═══ */
    .ov-grid{display:grid;grid-template-columns:1fr 340px;gap:24px;align-items:start}
    @media(max-width:1100px){.ov-grid{grid-template-columns:1fr}}

    /* Right column stacks cards top-aligned with no stretching */
    .ov-right{display:flex;flex-direction:column;gap:0}

    /* CARD */
    .card{background:var(--pure);border:1px solid var(--ghost);overflow:hidden;margin-bottom:20px}
    .card:last-child{margin-bottom:0}
    .card-hd{display:flex;align-items:center;justify-content:space-between;padding:18px 24px;border-bottom:1px solid var(--ghost)}
    .card-hd-l{display:flex;align-items:center;gap:12px}
    .card-ico{width:30px;height:30px;background:var(--off);border:1px solid var(--ghost);display:flex;align-items:center;justify-content:center;color:var(--black);flex-shrink:0}
    .card-title{font-size:14.5px;font-weight:700;color:var(--black);letter-spacing:-.01em}
    .card-sub{font-size:11px;color:var(--muted);margin-top:2px}
    .card-link{font-size:11px;color:var(--muted);font-weight:600;text-transform:uppercase;cursor:pointer;background:none;border:none;transition:color .15s}
    .card-link:hover{color:var(--black)}
    .card-bd{padding:24px}

    /* TABLE */
    .dtable{width:100%;border-collapse:collapse}
    .dtable thead{background:#fdfdfd;border-bottom:2px solid var(--ghost)}
    .dtable th{text-align:left;padding:11px 20px;font-size:9.5px;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:var(--muted);white-space:nowrap}
    .dtable td{padding:15px 20px;border-bottom:1px solid var(--ghost);font-size:13px;color:var(--mid);vertical-align:middle}
    .dtable tr:last-child td{border-bottom:none}
    .dtable tbody tr{transition:background .12s}
    .dtable tbody tr:hover td{background:#fdfdfd}

    /* USER CELL */
    .ucell{display:flex;align-items:center;gap:12px}
    .uavi{width:36px;height:36px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;border-radius:50%;overflow:hidden}
    .uavi-hr{background:#e0eaff;color:#3b5de0}
    .uavi-emp{background:#e0f5e9;color:#1c7a3e}
    .uavi-stu{background:#1a1a1a;color:#fff}
    .uname{font-weight:600;font-size:13.5px;color:var(--black);line-height:1.2}
    .uemail{font-size:11.5px;color:var(--muted);margin-top:2px}

    /* BADGES */
    .rbadge{display:inline-flex;align-items:center;gap:5px;font-size:11px;font-weight:700;padding:4px 11px;letter-spacing:.03em;text-transform:uppercase;border-radius:20px}
    .rb-hr{background:#e8effe;color:#3b5de0}
    .rb-emp{background:#e4f7ec;color:#1c7a3e}
    .rb-stu{background:#111;color:#fff}
    .sbadge{display:inline-flex;align-items:center;gap:6px;font-size:10.5px;font-weight:700;padding:4px 10px;text-transform:uppercase;letter-spacing:.04em;border-radius:20px}
    .sbadge::before{content:'';width:5px;height:5px;border-radius:50%;background:currentColor;flex-shrink:0}
    .sb-active{color:#15803d;background:#f0fdf4;border:1px solid #bbf7d0}
    .sb-inactive{color:var(--muted);background:var(--off);border:1px solid var(--ghost)}
    .sb-pending{color:#b45309;background:#fffbeb;border:1px solid #fde68a}

    /* ACTION BUTTONS */
    .abtns{display:flex;align-items:center;gap:6px;flex-wrap:nowrap}
    .abtn{font-size:11.5px;font-weight:600;padding:5px 12px;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .12s;border:1px solid transparent;white-space:nowrap;display:inline-flex;align-items:center;gap:5px;text-decoration:none;border-radius:5px}
    .abtn svg{width:11px;height:11px;flex-shrink:0}
    .ab-view{background:#f0f4ff;color:#3b5de0;border-color:#c7d4fc}
    .ab-view:hover{background:#e0eaff}
    .ab-edit{background:#f0fdf4;color:#15803d;border-color:#bbf7d0}
    .ab-edit:hover{background:#dcfce7}
    .ab-del{background:#fff5f5;color:#b91c1c;border-color:#fecaca}
    .ab-del:hover{background:#fee2e2}
    .ab-role{background:var(--off);color:var(--mid);border-color:var(--ghost)}
    .ab-role:hover{background:var(--ghost)}

    /* PROGRESS */
    .prog-bar{height:4px;background:var(--ghost);overflow:hidden;margin-top:8px;border-radius:2px}
    .prog-fill{height:100%;background:var(--black);border-radius:2px;transition:width .6s ease}

    /* ═══ TIMELINE — FIXED ═══ */
    .tl{display:flex;flex-direction:column}
    .tl-row{display:flex;gap:14px;padding-bottom:20px}
    .tl-row:last-child{padding-bottom:0}
    /* Left column: fixed width so dot never squishes */
    .tl-l{display:flex;flex-direction:column;align-items:center;flex-shrink:0;width:26px}
    .tl-dot{width:26px;height:26px;background:var(--off);border:1px solid var(--ghost);display:flex;align-items:center;justify-content:center;flex-shrink:0}
    .tl-line{width:1px;flex:1;background:var(--ghost);margin-top:4px;min-height:16px}
    .tl-row:last-child .tl-line{display:none}
    /* Right column: takes remaining space, text wraps cleanly */
    .tl-r{padding-top:3px;flex:1;min-width:0}
    .tl-t{font-size:12.5px;font-weight:600;color:var(--black);margin-bottom:2px;white-space:normal;word-break:break-word;line-height:1.4}
    .tl-d{font-size:11px;color:var(--muted)}

    /* PROFILE PAGE */
    .profile-banner{background:var(--black);padding:36px;margin-bottom:24px;display:flex;align-items:center;gap:26px;flex-wrap:wrap}
    .p-av{width:72px;height:72px;background:#1e1e1e;border:2px solid #2a2a2a;display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:900;color:var(--white);flex-shrink:0;border-radius:50%}
    .p-name{font-size:24px;font-weight:900;letter-spacing:-.03em;color:var(--white)}
    .p-email{font-size:12.5px;color:var(--subtle);margin-top:5px}
    .p-tags{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    .p-tag{font-size:10px;font-weight:600;padding:3px 10px;border:1px solid var(--mid);color:var(--muted);text-transform:uppercase}
    .p-tag-wh{border-color:var(--subtle);color:var(--white)}
    .p-right{margin-left:auto;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .two-col{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    @media(max-width:780px){.two-col{grid-template-columns:1fr}}

    /* FORMS */
    .fgrid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media(max-width:520px){.fgrid2{grid-template-columns:1fr}}
    .fg{display:flex;flex-direction:column;gap:7px;margin-bottom:14px}
    .fg:last-child{margin-bottom:0}
    .fl{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.04em}
    .fi,.fsel{width:100%;height:42px;padding:0 13px;background:var(--off);border:1px solid var(--ghost);font-family:'DM Sans',sans-serif;font-size:13.5px;color:var(--black);outline:none;transition:all .18s;border-radius:4px}
    .fi:focus,.fsel:focus{border-color:var(--black);background:var(--pure)}
    .fi::placeholder{color:var(--muted)}
    .fi[readonly]{color:var(--muted);cursor:default}
    .f-input{width:100%;height:42px;padding:0 13px;background:var(--off);border:1px solid var(--ghost);font-family:'DM Sans',sans-serif;font-size:13.5px;color:var(--black);outline:none;transition:all .18s}
    .f-input:focus{border-color:var(--black);background:var(--pure)}
    .f-input::placeholder{color:var(--muted)}
    .f-group{display:flex;flex-direction:column;gap:7px}
    .f-label{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.04em}
    .frow2{display:grid;grid-template-columns:1fr 1fr;gap:13px}
    @media(max-width:480px){.frow2{grid-template-columns:1fr}}
    .skill-wrap{display:flex;flex-wrap:wrap;gap:7px;margin-top:14px}
    .skill-tag{display:inline-flex;align-items:center;background:var(--black);color:var(--white);padding:5px 12px;font-size:11.5px;font-weight:600}
    .skill-tag.plain{background:var(--off);color:var(--mid);border:1px solid var(--ghost)}

    /* PASSWORD */
    .pw-wrap{max-width:480px}
    .req-box{background:var(--off);border:1px solid var(--ghost);padding:16px;margin-top:4px}
    .req-row{display:flex;align-items:center;gap:9px;font-size:12px;color:var(--muted);margin-bottom:8px;transition:color .15s}
    .req-row:last-child{margin-bottom:0}

    /* NOTIFICATIONS */
    .notif-list{display:flex;flex-direction:column}
    .notif-row{display:flex;align-items:flex-start;gap:16px;padding:20px 0;border-bottom:1px solid var(--ghost)}
    .notif-row:last-child{border-bottom:none}
    .ni-ico{width:34px;height:34px;background:var(--off);border:1px solid var(--ghost);display:flex;align-items:center;justify-content:center;flex-shrink:0}
    .ni-text{font-size:13.5px;color:var(--mid);line-height:1.65}
    .ni-text strong{color:var(--black);font-weight:600}
    .ni-time{font-size:10.5px;color:var(--muted);margin-top:5px}

    /* ═══════ MODAL SYSTEM ═══════ */
    .mov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.52);z-index:800;align-items:center;justify-content:center;padding:16px;backdrop-filter:blur(2px)}
    .mov.open{display:flex}
    .mbox{background:var(--pure);width:100%;max-width:500px;box-shadow:0 32px 80px rgba(0,0,0,.18);animation:popIn .22s ease;border-radius:4px}
    .mbox.wide{max-width:600px}
    .mbox.confirm{max-width:380px;text-align:center;padding-bottom:10px}
    @keyframes popIn{from{opacity:0;transform:scale(.95) translateY(12px)}to{opacity:1;transform:scale(1) translateY(0)}}
    .mhd{display:flex;align-items:flex-start;justify-content:space-between;padding:22px 26px;border-bottom:1px solid var(--ghost)}
    .mhd-title{font-size:17px;font-weight:800;color:var(--black)}
    .mhd-sub{font-size:11.5px;color:var(--muted);margin-top:4px}
    .mcl{width:30px;height:30px;border:1px solid var(--ghost);background:none;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:16px;transition:all .15s;border-radius:4px;flex-shrink:0}
    .mcl:hover{background:var(--off);color:var(--black)}
    .mbd{padding:26px}
    .mft{display:flex;justify-content:flex-end;gap:8px;padding:18px 26px;border-top:1px solid var(--ghost)}

    /* View detail grid */
    .vd-hero{display:flex;align-items:center;gap:18px;padding:24px 26px;border-bottom:1px solid var(--ghost);background:var(--off)}
    .vd-avi{width:58px;height:58px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:900;overflow:hidden}
    .vd-avi img{width:100%;height:100%;object-fit:cover}
    .vd-name{font-size:18px;font-weight:800;color:var(--black)}
    .vd-role{margin-top:5px}
    .vd-grid{display:grid;grid-template-columns:1fr 1fr}
    .vd-cell{padding:16px 26px;border-bottom:1px solid var(--ghost);border-right:1px solid var(--ghost)}
    .vd-cell:nth-child(even){border-right:none}
    .vd-cell:nth-last-child(-n+2){border-bottom:none}
    .vd-key{font-size:9.5px;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:var(--muted);margin-bottom:5px}
    .vd-val{font-size:13.5px;color:var(--black);font-weight:500;word-break:break-word}
    @media(max-width:520px){.vd-grid{grid-template-columns:1fr}.vd-cell{border-right:none}.vd-cell:nth-last-child(-n+2){border-bottom:1px solid var(--ghost)}.vd-cell:last-child{border-bottom:none}}

    /* Confirm modal */
    .conf-ico{font-size:44px;margin:30px 0 12px}
    .conf-t{font-size:18px;font-weight:800;color:var(--black);margin-bottom:10px}
    .conf-d{font-size:13px;color:var(--muted);margin-bottom:28px;padding:0 20px;line-height:1.65}

    /* Company add modal */
    .modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:900;align-items:center;justify-content:center}
    .modal-box{background:white;width:100%;max-width:420px;border-radius:4px;animation:popIn .25s ease;box-shadow:0 28px 80px rgba(0,0,0,.16)}
    .modal-hd{display:flex;justify-content:space-between;align-items:center;padding:18px 22px;border-bottom:1px solid var(--ghost)}
    .modal-title{font-size:16px;font-weight:700}
    .modal-close{border:none;background:none;font-size:18px;cursor:pointer;color:var(--muted)}
    .modal-bd{padding:22px}
    .modal-ft{display:flex;justify-content:flex-end;gap:10px;padding:16px 22px;border-top:1px solid var(--ghost)}

    /* TOAST */
    .toast{position:fixed;bottom:26px;right:26px;background:var(--black);color:var(--white);padding:12px 20px;font-size:13px;font-weight:500;z-index:999;display:flex;align-items:center;gap:9px;opacity:0;transform:translateY(16px);transition:all .28s cubic-bezier(.4,0,.2,1);pointer-events:none;box-shadow:0 8px 32px rgba(0,0,0,.2);border-radius:4px}
    .toast.show{opacity:1;transform:translateY(0)}
    .toast.toast-err{background:#b91c1c}
    .toast svg{width:14px;height:14px;flex-shrink:0}

    .mob-ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:150}

    /* RESPONSIVE */
    @media(max-width:900px){.stats-row{grid-template-columns:1fr 1fr}}
    @media(max-width:768px){
        .sidebar{transform:translateX(-100%)}
        .sidebar.open{transform:translateX(0)}
        .mob-ov.open{display:block}
        .main{margin-left:0}.topnav{left:0}
        .hamburger{display:flex}
        .search-bar{flex:1;max-width:none}
        .page{padding:24px 18px 56px}
        .stat-val{font-size:36px}
        .ov-grid{grid-template-columns:1fr}
        .dtable th:nth-child(4),.dtable td:nth-child(4),
        .dtable th:nth-child(5),.dtable td:nth-child(5){display:none}
    }
    @media(max-width:560px){.stats-row{grid-template-columns:1fr}.ab-view{display:none}}
    ::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:var(--light)}
</style>
</head>
<body>

<!-- PAGE LOADER -->
<div id="page-loader">
  <div class="bars-loader">
    <span class="bar"></span><span class="bar"></span><span class="bar"></span>
    <span class="bar"></span><span class="bar"></span>
  </div>
</div>
<form id="csrfForm">{% csrf_token %}</form>
<script>
  window.addEventListener("load",function(){
    var l=document.getElementById("page-loader");
    l.style.opacity="0";l.style.transition="opacity 1s ease";
    setTimeout(function(){l.style.display="none"},1000);
  });
</script>

<div class="mob-ov" id="mobOv" onclick="toggleSB()"></div>

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <div class="logo-mark">IH</div>
    <span class="logo-name">InternHub</span>
    <span class="logo-pill">Beta</span>
  </div>
  <div class="nav-label">Main</div>
  <button class="nav-item active" onclick="showPage('dashboard',this)">
    <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
    Overview
  </button>
  <button class="nav-item" onclick="showPage('hr',this)">
    <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg>
    HR Management
    <span class="nb nb-mid">{{ hr_count }}</span>
  </button>
  <button class="nav-item" onclick="showPage('employees',this)">
    <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    Companies
    <span class="nb nb-dk">{{ emp_count }}</span>
  </button>
  <button class="nav-item" onclick="showPage('students',this)">
    <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
    Students / Users
    <span class="nb nb-dk">{{ student_count }}</span>
  </button>
  <div class="nav-label" style="margin-top:4px">Updates</div>
  <button class="nav-item" onclick="showPage('notifications',this)">
    <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0"/></svg>
    Notifications
    <span class="nb nb-mid">3</span>
  </button>
  <div class="sidebar-footer">
    <div class="profile-popup">
      <button class="popup-item" onclick="showPage('profile',null);markPopupActive('profile')">
        <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>My Profile
      </button>
      <button class="popup-item" onclick="showPage('password',null);markPopupActive('password')">
        <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><rect x="5" y="11" width="14" height="10"/><path d="M8 11V7a4 4 0 018 0v4"/></svg>Reset Password
      </button>
      <button class="popup-item danger" onclick="handleLogout()">
        <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>Logout
      </button>
    </div>
    <div class="user-tile">
      <div class="u-av">AD</div>
      <div><div class="u-name-s">Admin</div><div class="u-role-s">Super Admin</div></div>
      <svg class="u-chev" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M5 15l7-7 7 7"/></svg>
    </div>
  </div>
</aside>

<!-- TOPNAV -->
<header class="topnav">
  <button class="ico-btn hamburger" onclick="toggleSB()">
    <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
  </button>
  <div class="search-bar">
    <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
    <input type="text" id="gSearch" placeholder="Search users, roles, departments…">
  </div>
  <div class="tnav-r">
    <button class="ico-btn" onclick="showPage('notifications',document.querySelectorAll('.nav-item')[4])">
      <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0"/></svg>
      <span class="notif-dot"></span>
    </button>
    <button class="btn btn-dark">
      <svg width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>Browse Jobs
    </button>
    <div class="u-av" style="width:34px;height:34px;font-size:12px;cursor:pointer;border:1px solid #1f1f1f">AD</div>
  </div>
</header>

<main class="main">

<!-- ══ OVERVIEW PAGE ══ -->
<div class="page active" id="page-dashboard">
  <div class="ph">
    <div><h1 class="ph-title">Admin Dashboard</h1><p class="ph-sub" id="dash-date">Loading…</p></div>
  </div>
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-top"><span class="stat-lbl">HR Managers</span><span class="stat-pill pill-dk">+1 New</span></div>
      <div class="stat-val">{{ hr_count }}</div>
    </div>
    <div class="stat-card">
      <div class="stat-top"><span class="stat-lbl">Companies</span><span class="stat-pill pill-dk">+2 New</span></div>
      <div class="stat-val">{{ emp_count }}</div>
    </div>
    <div class="stat-card">
      <div class="stat-top"><span class="stat-lbl">Profile Health</span><span class="stat-pill pill-gh">Stable</span></div>
      <div class="stat-val">99.9%</div>
    </div>
  </div>

  <div class="ov-grid">
    <!-- LEFT: All Users table -->
    <div>
      <div class="card">
        <div class="card-hd">
          <div class="card-hd-l">
            <div class="card-ico"><svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M4 20a8 8 0 0116 0"/></svg></div>
            <div><div class="card-title">All Users</div><div class="card-sub">Manage HR, Companies &amp; Students</div></div>
          </div>
          <button class="btn btn-dark" style="height:33px;font-size:11.5px;padding:0 15px" onclick="openAdd()">+ Add User</button>
        </div>
        <div style="overflow-x:auto">
          <table class="dtable">
            <thead><tr><th>User</th><th>Role</th><th>Department / Field</th><th>Status</th><th>ID</th><th>Actions</th></tr></thead>
            <tbody>
              {% for u in users %}{% if u.role == "emp" or u.role == "user" or u.role == "hr" %}
              <tr>
                <td>
                  <div class="ucell">
                    <div class="uavi {% if u.role == 'hr' %}uavi-hr{% elif u.role == 'emp' %}uavi-emp{% else %}uavi-stu{% endif %}">
                      {% if u.profile_url %}<img src="{{ u.profile_url }}" style="width:100%;height:100%;object-fit:cover;">{% else %}{{ u.full_name|first }}{% endif %}
                    </div>
                    <div><div class="uname">{{ u.full_name }}</div><div class="uemail">{{ u.Email }}</div></div>
                  </div>
                </td>
                <td>{% if u.role == "hr" %}<span class="rbadge rb-hr">HR</span>{% elif u.role == "emp" %}<span class="rbadge rb-emp">Employee</span>{% else %}<span class="rbadge rb-stu">User</span>{% endif %}</td>
                <td style="color:var(--muted);font-size:12.5px">{{ u.course|default:"—" }}</td>
                <td><span class="sbadge sb-active">Active</span></td>
                <td style="color:var(--muted);font-size:12.5px">#{{ u.id }}</td>
                <td>
                  <div class="abtns">
                    <button class="abtn ab-view" onclick="openHrView({{ u.id }})">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>View
                    </button>
                    <button class="abtn ab-edit" onclick="openHrEdit({{ u.id }})">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>Edit
                    </button>
                    <button class="abtn ab-del" onclick="openDeleteModal('user',{{ u.id }},'{{ u.full_name|escapejs }}')">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/></svg>Delete
                    </button>
                  </div>
                </td>
              </tr>
              {% endif %}{% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- RIGHT: System Stats + Recent Activity — fixed with .ov-right wrapper -->
    <div class="ov-right">

      <div class="card">
        <div class="card-hd">
          <div class="card-hd-l">
            <div class="card-ico"><svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg></div>
            <div class="card-title">System Stats</div>
          </div>
          <button class="card-link">Edit →</button>
        </div>
        <div class="card-bd">
          <div style="display:flex;flex-direction:column;gap:18px">
            <div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
                <span style="font-size:12.5px;font-weight:600;color:var(--black)">Active Users</span>
                <span style="font-size:11px;font-weight:700;color:var(--muted)">87%</span>
              </div>
              <div class="prog-bar"><div class="prog-fill" style="width:87%"></div></div>
            </div>
            <div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
                <span style="font-size:12.5px;font-weight:600;color:var(--black)">Job Fill Rate</span>
                <span style="font-size:11px;font-weight:700;color:var(--muted)">74%</span>
              </div>
              <div class="prog-bar"><div class="prog-fill" style="width:74%"></div></div>
            </div>
            <div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
                <span style="font-size:12.5px;font-weight:600;color:var(--black)">Placement Rate</span>
                <span style="font-size:11px;font-weight:700;color:var(--muted)">61%</span>
              </div>
              <div class="prog-bar"><div class="prog-fill" style="width:61%"></div></div>
            </div>
            <div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
                <span style="font-size:12.5px;font-weight:600;color:var(--black)">Profile Health</span>
                <span style="font-size:11px;font-weight:700;color:var(--muted)">99%</span>
              </div>
              <div class="prog-bar"><div class="prog-fill" style="width:99%"></div></div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-hd">
          <div class="card-hd-l">
            <div class="card-ico"><svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg></div>
            <div class="card-title">Recent Activity</div>
          </div>
        </div>
        <div class="card-bd">
          <div class="tl">
            <div class="tl-row">
              <div class="tl-l">
                <div class="tl-dot" style="background:var(--black)"><svg width="10" height="10" fill="none" viewBox="0 0 24 24" stroke="var(--white)" stroke-width="3"><path d="M5 13l4 4L19 7"/></svg></div>
                <div class="tl-line"></div>
              </div>
              <div class="tl-r"><div class="tl-t">Anjali Sharma added as HR</div><div class="tl-d">2 hours ago</div></div>
            </div>
            <div class="tl-row">
              <div class="tl-l">
                <div class="tl-dot"><svg width="10" height="10" fill="none" viewBox="0 0 24 24" stroke="var(--mid)" stroke-width="2.5"><circle cx="12" cy="8" r="4"/><path d="M4 20a8 8 0 0116 0"/></svg></div>
                <div class="tl-line"></div>
              </div>
              <div class="tl-r"><div class="tl-t">Sonu Kumar updated profile</div><div class="tl-d">5 hours ago</div></div>
            </div>
            <div class="tl-row">
              <div class="tl-l">
                <div class="tl-dot"><svg width="10" height="10" fill="none" viewBox="0 0 24 24" stroke="var(--muted)" stroke-width="2.5"><path d="M12 5v14M5 12h14"/></svg></div>
              </div>
              <div class="tl-r"><div class="tl-t">Vikram Singh joined Engineering</div><div class="tl-d">Yesterday</div></div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /.ov-right -->
  </div><!-- /.ov-grid -->
</div><!-- /#page-dashboard -->


<!-- ══ HR PAGE ══ -->
<div class="page" id="page-hr">
  <div class="ph">
    <div><h1 class="ph-title">HR Management</h1><p class="ph-sub" id="hr-date">Loading…</p></div>
    <button class="btn btn-dark" onclick="openAdd('HR')">+ Add HR Manager</button>
  </div>
  <div class="card">
    <div class="card-hd">
      <div class="card-hd-l">
        <div class="card-ico" style="background:#e8effe;border-color:#c7d4fc"><svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="#3b5de0" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg></div>
        <div><div class="card-title">HR Managers</div><div class="card-sub">Hiring and recruitment specialists</div></div>
      </div>
    </div>
    <div style="overflow-x:auto">
      <table class="dtable">
        <thead><tr><th>#</th><th>HR Manager</th><th>Email</th><th>Phone</th><th>Department</th><th>Status</th><th>Actions</th></tr></thead>
        <tbody>
          {% for u in users %}{% if u.role == "hr" %}
          <tr>
            <td style="color:var(--muted);font-size:12px;font-weight:600">{{ forloop.counter }}</td>
            <td>
              <div class="ucell">
                <div class="uavi uavi-hr">{% if u.profile_url %}<img src="{{ u.profile_url }}" style="width:100%;height:100%;object-fit:cover;">{% else %}{{ u.full_name|first }}{% endif %}</div>
                <div><div class="uname">{{ u.full_name }}</div><div class="uemail">HR Manager</div></div>
              </div>
            </td>
            <td style="font-size:13px;color:var(--mid)">{{ u.Email }}</td>
            <td style="font-size:13px;color:var(--mid)">{{ u.phoneno|default:"—" }}</td>
            <td style="font-size:13px;color:var(--mid)">{{ u.course|default:"—" }}</td>
            <td><span class="sbadge sb-active">Active</span></td>
            <td>
              <div class="abtns">
                <button class="abtn ab-view" onclick="openHrView({{ u.id }})">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>View
                </button>
                <button class="abtn ab-edit" onclick="openHrEdit({{ u.id }})">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>Edit
                </button>
                <button class="abtn ab-del" onclick="openDeleteModal('user',{{ u.id }},'{{ u.full_name|escapejs }}')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/></svg>Delete
                </button>
                <a href="" class="abtn ab-role">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 11 18 13 22 9"/><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>Role
                </a>
              </div>
            </td>
          </tr>
          {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>


<!-- ══ COMPANIES PAGE ══ -->
<div class="page" id="page-employees">
  <div class="ph">
    <div><h1 class="ph-title">Companies</h1><p class="ph-sub" id="emp-date">Loading…</p></div>
    <button class="btn btn-dark" onclick="openCompanyModal()">+ Add Company</button>
  </div>
  <div class="card">
    <div class="card-hd">
      <div class="card-hd-l">
        <div class="card-ico" style="background:#e4f7ec;border-color:#a7e4bc"><svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="#1c7a3e" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
        <div><div class="card-title">Company Records</div><div class="card-sub">Registered partner organisations</div></div>
      </div>
    </div>
    <div style="overflow-x:auto">
      <table class="dtable">
        <thead><tr><th>#</th><th>Company Name</th><th>Email</th><th>Website</th><th>Location</th><th>Actions</th></tr></thead>
        <tbody>
          {% for u in emp %}
          <tr>
            <td style="color:var(--muted);font-size:12px;font-weight:600">{{ forloop.counter }}</td>
            <td>
              <div class="ucell">
                <div class="uavi uavi-emp" style="border-radius:8px;font-size:12px;font-weight:800">{{ u.company_name|first|upper }}</div>
                <div><div class="uname">{{ u.company_name }}</div><div class="uemail">Company</div></div>
              </div>
            </td>
            <td style="font-size:13px;color:var(--mid)">{{ u.email }}</td>
            <td style="font-size:13px"><a href="{{ u.website }}" target="_blank" style="color:#3b5de0;text-decoration:none">{{ u.website|default:"—" }}</a></td>
            <td style="font-size:13px;color:var(--mid)">{{ u.location|default:"—" }}</td>
            <td>
              <div class="abtns">
                <button class="abtn ab-view" onclick="openCompanyView({{ u.id }})">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>View
                </button>
                <button class="abtn ab-edit" onclick="openCompanyEdit({{ u.id }})">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>Edit
                </button>
                <button class="abtn ab-del" onclick="openDeleteModal('company',{{ u.id }},'{{ u.company_name|escapejs }}')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/></svg>Delete
                </button>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="6" style="text-align:center;padding:36px;color:var(--muted)">No companies found</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>


<!-- ══ STUDENTS PAGE ══ -->
<div class="page" id="page-students">
  <div class="ph">
    <div><h1 class="ph-title">Students / Users</h1><p class="ph-sub" id="stu-date">Loading…</p></div>
    <button class="btn btn-dark" onclick="openAdd('Student')">+ Add Student</button>
  </div>
  <div class="card">
    <div class="card-hd">
      <div class="card-hd-l">
        <div class="card-ico" style="background:#111;border-color:#333"><svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="#aaa" stroke-width="2"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg></div>
        <div><div class="card-title">Student Accounts</div><div class="card-sub">Registered students seeking internships</div></div>
      </div>
    </div>
    <div style="overflow-x:auto">
      <table class="dtable">
        <thead><tr><th>#</th><th>Student</th><th>Email</th><th>Phone</th><th>Course</th><th>Actions</th></tr></thead>
        <tbody>
          {% for u in users %}{% if u.role != "hr" and u.role != "emp" and u.role != "admin" %}
          <tr>
            <td style="color:var(--muted);font-size:12px;font-weight:600">{{ forloop.counter }}</td>
            <td>
              <div class="ucell">
                <div class="uavi uavi-stu" style="border-radius:50%">
                  {% if u.profile_url %}<img src="{{ u.profile_url }}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">{% else %}{{ u.full_name|first }}{% endif %}
                </div>
                <div><div class="uname">{{ u.full_name }}</div><div class="uemail">{{ u.course|default:"Student" }}</div></div>
              </div>
            </td>
            <td style="font-size:13px;color:var(--mid)">{{ u.Email }}</td>
            <td style="font-size:13px;color:var(--mid)">{{ u.phoneno|default:"—" }}</td>
            <td style="font-size:13px;color:var(--mid)">{{ u.course|default:"—" }}</td>
            <td>
              <div class="abtns">
                <button class="abtn ab-view" onclick="openStudentView({{ u.id }})">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>View
                </button>
                <button class="abtn ab-edit" onclick="openStudentEdit({{ u.id }})">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>Edit
                </button>
                <button class="abtn ab-del" onclick="openDeleteModal('user',{{ u.id }},'{{ u.full_name|escapejs }}')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/></svg>Delete
                </button>
              </div>
            </td>
          </tr>
          {% endif %}{% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>


<!-- ══ NOTIFICATIONS ══ -->
<div class="page" id="page-notifications">
  <div class="ph">
    <div><h1 class="ph-title">Notifications</h1><p class="ph-sub">3 unread messages</p></div>
    <button class="btn btn-outline" style="font-size:11.5px;text-transform:uppercase;letter-spacing:.05em">Mark all read</button>
  </div>
  <div class="card">
    <div class="card-bd" style="padding:0 28px">
      <div class="notif-list">
        <div class="notif-row"><div class="ni-ico" style="background:var(--black)"><svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="var(--white)" stroke-width="2.5"><path d="M5 13l4 4L19 7"/></svg></div><div><div class="ni-text"><strong>Anjali Sharma</strong> was added as HR Manager in Talent Acquisition.</div><div class="ni-time">2 hours ago</div></div></div>
        <div class="notif-row"><div class="ni-ico"><svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="var(--mid)" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M4 20a8 8 0 0116 0"/></svg></div><div><div class="ni-text"><strong>Sonu Kumar</strong> updated their profile. Profile health is now 99.9%.</div><div class="ni-time">5 hours ago</div></div></div>
        <div class="notif-row"><div class="ni-ico"><svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="var(--mid)" stroke-width="2"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg></div><div><div class="ni-text"><strong>Arjun Reddy</strong>'s employee account is pending approval in Marketing.</div><div class="ni-time">1 day ago</div></div></div>
        <div class="notif-row"><div class="ni-ico"><svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="var(--muted)" stroke-width="2"><path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg></div><div><div class="ni-text">Welcome to <strong>InternHub Admin!</strong> Your super admin account is fully configured.</div><div class="ni-time">3 days ago</div></div></div>
      </div>
    </div>
  </div>
</div>


<!-- ══ PROFILE ══ -->
<div class="page" id="page-profile">
  <div class="ph"><h1 class="ph-title">My Profile</h1></div>
  <div class="profile-banner">
    <div class="p-av">AD</div>
    <div>
      <div class="p-name">Admin User</div><div class="p-email">admin@internhub.in</div>
      <div class="p-tags"><span class="p-tag p-tag-wh">Super Admin</span><span class="p-tag p-tag-wh">Full Access ✓</span></div>
    </div>
    <div class="p-right">
      <button class="btn" style="background:transparent;color:var(--muted);border:1px solid var(--mid);font-size:11.5px">Upload Photo</button>
      <button class="btn btn-outline" style="border-color:var(--white);background:var(--white);color:var(--black)" onclick="saveProfile()">Save Changes</button>
    </div>
  </div>
  <div class="two-col">
    <div class="card">
      <div class="card-hd"><div class="card-hd-l"><div class="card-ico"><svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg></div><div class="card-title">Personal Information</div></div></div>
      <div class="card-bd">
        <div class="fgrid2">
          <div class="f-group"><label class="f-label">Full Name</label><input class="f-input" type="text" value="Admin User"></div>
          <div class="f-group"><label class="f-label">Email Address</label><input class="f-input" type="email" value="admin@internhub.in"></div>
          <div class="f-group"><label class="f-label">Phone Number</label><input class="f-input" type="tel" value="+91 98765 43210"></div>
          <div class="f-group"><label class="f-label">Role</label><input class="f-input" type="text" value="Super Admin" readonly style="background:var(--off);color:var(--muted)"></div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-hd"><div class="card-hd-l"><div class="card-ico"><svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg></div><div class="card-title">Admin Permissions</div></div></div>
      <div class="card-bd">
        <p style="font-size:11px;color:var(--muted);margin-bottom:16px">Your current access level and permissions</p>
        <div class="skill-wrap"><span class="skill-tag">User Management</span><span class="skill-tag">HR Control</span><span class="skill-tag">Job Listings</span><span class="skill-tag">Analytics</span><span class="skill-tag plain">Reports</span><span class="skill-tag plain">Settings</span><span class="skill-tag plain">Notifications</span></div>
      </div>
    </div>
  </div>
</div>


<!-- ══ PASSWORD ══ -->
<div class="page" id="page-password">
  <div class="ph"><div><h1 class="ph-title">Reset Password</h1><p class="ph-sub">Update your admin account password</p></div></div>
  <div class="pw-wrap">
    <div class="card">
      <div class="card-hd"><div class="card-hd-l"><div class="card-ico"><svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><rect x="5" y="11" width="14" height="10"/><path d="M8 11V7a4 4 0 018 0v4"/></svg></div><div class="card-title">Change Password</div></div></div>
      <div id="pwMsg"></div>
      <div class="card-bd">
        <form id="pwForm" onsubmit="handlePwSubmit(event)">
          <div style="display:flex;flex-direction:column;gap:16px">
            <div class="f-group"><label class="f-label">Current Password</label><input class="f-input" type="password" id="pwCurrent" placeholder="Enter current password" required></div>
            <div class="f-group"><label class="f-label">New Password</label><input class="f-input" type="password" id="pwNew" placeholder="Min. 8 characters" required oninput="checkPwReqs()"></div>
            <div class="f-group"><label class="f-label">Confirm New Password</label><input class="f-input" type="password" id="pwConfirm" placeholder="Re-enter new password" required></div>
            <div class="req-box">
              <div style="font-size:9.5px;font-weight:800;color:var(--muted);margin-bottom:12px;text-transform:uppercase;letter-spacing:.1em">Requirements</div>
              <div class="req-row" id="req-len"><svg width="11" height="11" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="9"/></svg>At least 8 characters</div>
              <div class="req-row" id="req-upper"><svg width="11" height="11" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="9"/></svg>One uppercase letter</div>
              <div class="req-row" id="req-special"><svg width="11" height="11" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="9"/></svg>One special character</div>
            </div>
            <div style="display:flex;gap:10px">
              <button type="submit" class="btn btn-dark" style="flex:2;justify-content:center;font-size:12px">Update Password</button>
              <button type="button" class="btn btn-outline" style="font-size:12px" onclick="document.getElementById('pwForm').reset();resetPwReqs()">Clear</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
</main>


<!-- ═══════════════ MODALS ═══════════════ -->

<!-- HR VIEW -->
<div class="mov" id="hrViewModal">
  <div class="mbox wide">
    <div class="mhd"><div><div class="mhd-title">HR Manager Profile</div><div class="mhd-sub">Read-only view</div></div><button class="mcl" onclick="closeMov('hrViewModal')">✕</button></div>
    <div id="hrViewBody"><div class="loader"></div></div>
    <div class="mft">
      <button class="btn btn-ghost" style="height:38px;font-size:12.5px" onclick="closeMov('hrViewModal')">Close</button>
      <button class="btn btn-dark" style="height:38px;font-size:12.5px" id="hrViewEditBtn">Edit HR</button>
    </div>
  </div>
</div>

<!-- HR EDIT -->
<div class="mov" id="hrEditModal">
  <div class="mbox">
    <div class="mhd"><div><div class="mhd-title">Edit HR Manager</div><div class="mhd-sub">Update member information</div></div><button class="mcl" onclick="closeMov('hrEditModal')">✕</button></div>
    <div class="mbd">
      <form id="hrEditForm">
        {% csrf_token %}
        <input type="hidden" id="hrEditId">
        <div class="frow2">
          <div class="fg"><label class="fl">Full Name</label><input class="fi" id="hrEditName" placeholder="Full name" required></div>
          <div class="fg"><label class="fl">Email</label><input class="fi" id="hrEditEmail" type="email" placeholder="Email address" required></div>
        </div>
        <div class="frow2">
          <div class="fg"><label class="fl">Phone</label><input class="fi" id="hrEditPhone" placeholder="Phone number"></div>
          <div class="fg"><label class="fl">Department</label><input class="fi" id="hrEditDept" placeholder="Department / field"></div>
        </div>
        <div class="fg"><label class="fl">Status</label>
          <select class="fsel" id="hrEditStatus">
            <option value="Active">Active</option><option value="Inactive">Inactive</option><option value="Pending">Pending</option>
          </select>
        </div>
      </form>
    </div>
    <div class="mft">
      <button class="btn btn-ghost" style="height:38px;font-size:12.5px" onclick="closeMov('hrEditModal')">Cancel</button>
      <button class="btn btn-dark" style="height:38px;font-size:12.5px" onclick="submitHrEdit()">Save Changes</button>
    </div>
  </div>
</div>

<!-- COMPANY VIEW -->
<div class="mov" id="companyViewModal">
  <div class="mbox wide">
    <div class="mhd"><div><div class="mhd-title">Company Profile</div><div class="mhd-sub">Read-only view</div></div><button class="mcl" onclick="closeMov('companyViewModal')">✕</button></div>
    <div id="companyViewBody"><div class="loader"></div></div>
    <div class="mft">
      <button class="btn btn-ghost" style="height:38px;font-size:12.5px" onclick="closeMov('companyViewModal')">Close</button>
      <button class="btn btn-dark" style="height:38px;font-size:12.5px" id="companyViewEditBtn">Edit Company</button>
    </div>
  </div>
</div>

<!-- COMPANY EDIT -->
<div class="mov" id="companyEditModal">
  <div class="mbox">
    <div class="mhd"><div><div class="mhd-title">Edit Company</div><div class="mhd-sub">Update company details</div></div><button class="mcl" onclick="closeMov('companyEditModal')">✕</button></div>
    <div class="mbd">
      <form id="companyEditForm">
        {% csrf_token %}
        <input type="hidden" id="companyEditId">
        <div class="fg"><label class="fl">Company Name</label><input class="fi" id="companyEditName" placeholder="Company name" required></div>
        <div class="frow2">
          <div class="fg"><label class="fl">Email</label><input class="fi" id="companyEditEmail" type="email" placeholder="Company email"></div>
          <div class="fg"><label class="fl">Website</label><input class="fi" id="companyEditWebsite" placeholder="https://..."></div>
        </div>
        <div class="fg"><label class="fl">Location</label><input class="fi" id="companyEditLocation" placeholder="City, Country"></div>
      </form>
    </div>
    <div class="mft">
      <button class="btn btn-ghost" style="height:38px;font-size:12.5px" onclick="closeMov('companyEditModal')">Cancel</button>
      <button class="btn btn-dark" style="height:38px;font-size:12.5px" onclick="submitCompanyEdit()">Save Changes</button>
    </div>
  </div>
</div>

<!-- STUDENT VIEW -->
<div class="mov" id="studentViewModal">
  <div class="mbox wide">
    <div class="mhd"><div><div class="mhd-title">Student Profile</div><div class="mhd-sub">Read-only view</div></div><button class="mcl" onclick="closeMov('studentViewModal')">✕</button></div>
    <div id="studentViewBody"><div class="loader"></div></div>
    <div class="mft">
      <button class="btn btn-ghost" style="height:38px;font-size:12.5px" onclick="closeMov('studentViewModal')">Close</button>
      <button class="btn btn-dark" style="height:38px;font-size:12.5px" id="studentViewEditBtn">Edit Student</button>
    </div>
  </div>
</div>

<!-- STUDENT EDIT -->
<div class="mov" id="studentEditModal">
  <div class="mbox">
    <div class="mhd"><div><div class="mhd-title">Edit Student</div><div class="mhd-sub">Update student account details</div></div><button class="mcl" onclick="closeMov('studentEditModal')">✕</button></div>
    <div class="mbd">
      <form id="studentEditForm">
        {% csrf_token %}
        <input type="hidden" id="studentEditId">
        <div class="frow2">
          <div class="fg"><label class="fl">Full Name</label><input class="fi" id="studentEditName" placeholder="Full name" required></div>
          <div class="fg"><label class="fl">Email</label><input class="fi" id="studentEditEmail" type="email" placeholder="Email address" required></div>
        </div>
        <div class="frow2">
          <div class="fg"><label class="fl">Phone</label><input class="fi" id="studentEditPhone" placeholder="Phone number"></div>
          <div class="fg"><label class="fl">Course</label><input class="fi" id="studentEditCourse" placeholder="Course / Year"></div>
        </div>
        <div class="fg"><label class="fl">Status</label>
          <select class="fsel" id="studentEditStatus">
            <option value="Active">Active</option><option value="Inactive">Inactive</option><option value="Pending">Pending</option>
          </select>
        </div>
      </form>
    </div>
    <div class="mft">
      <button class="btn btn-ghost" style="height:38px;font-size:12.5px" onclick="closeMov('studentEditModal')">Cancel</button>
      <button class="btn btn-dark" style="height:38px;font-size:12.5px" onclick="submitStudentEdit()">Save Changes</button>
    </div>
  </div>
</div>

<!-- SHARED DELETE CONFIRM -->
<div class="mov" id="deleteModal">
  <div class="mbox confirm">
    <div class="conf-ico" id="deleteIcon">🗑️</div>
    <div class="conf-t" id="deleteTitle">Delete this record?</div>
    <div class="conf-d" id="deleteDesc">This action is permanent and cannot be undone.</div>
    <div class="mft" style="justify-content:center;border:none;padding-top:0">
      <button class="btn btn-ghost" style="height:38px;font-size:12.5px" onclick="closeMov('deleteModal')">Cancel</button>
      <button class="btn btn-danger" style="height:38px;font-size:12.5px" id="deleteConfirmBtn">Yes, Delete</button>
    </div>
  </div>
</div>

<!-- ADD COMPANY -->
<div class="modal-overlay" id="companyModal">
  <div class="modal-box">
    <div class="modal-hd"><div class="modal-title">Add Company</div><button class="modal-close" onclick="closeCompanyModal()">✕</button></div>
    <form id="companyForm">
      {% csrf_token %}
      <div class="modal-bd">
        <div class="fg"><label class="fl">Company Name</label><input class="fi" name="company_name" required></div>
        <div class="fg"><label class="fl">Email</label><input class="fi" type="email" name="email"></div>
        <div class="fg"><label class="fl">Website</label><input class="fi" name="website"></div>
        <div class="fg"><label class="fl">Location</label><input class="fi" name="location"></div>
      </div>
      <div class="modal-ft">
        <button type="button" class="btn btn-ghost" onclick="closeCompanyModal()">Cancel</button>
        <button type="submit" class="btn btn-dark">Save Company</button>
      </div>
    </form>
  </div>
</div>

<!-- ADD USER -->
<div class="mov" id="addModal">
  <div class="mbox">
    <div class="mhd"><div class="mhd-title" id="modal-title">Add User</div><button class="mcl" onclick="closeMov('addModal')">✕</button></div>
    <div class="mbd">
      <div class="frow2">
        <div class="fg"><label class="fl">First Name</label><input class="fi" id="fFirst" placeholder="e.g. Anjali"></div>
        <div class="fg"><label class="fl">Last Name</label><input class="fi" id="fLast" placeholder="e.g. Sharma"></div>
      </div>
      <div class="fg"><label class="fl">Email</label><input class="fi" id="fEmail" type="email" placeholder="user@example.com"></div>
      <div class="frow2">
        <div class="fg"><label class="fl">Role</label><select class="fsel" id="fRole"><option>HR</option><option>Employee</option><option>Student</option></select></div>
        <div class="fg"><label class="fl">Status</label><select class="fsel" id="fStatus"><option>Active</option><option>Inactive</option><option>Pending</option></select></div>
      </div>
      <div class="fg"><label class="fl">Department / Field</label><input class="fi" id="fDept" placeholder="e.g. Engineering, CS · 3rd Year"></div>
    </div>
    <div class="mft">
      <button class="btn btn-ghost" style="height:38px;font-size:12.5px" onclick="closeMov('addModal')">Cancel</button>
      <button class="btn btn-dark" style="height:38px;font-size:12.5px" id="saveBtn" onclick="saveUser()">Save User</button>
    </div>
  </div>
</div>

<!-- LOGOUT -->
<div class="mov" id="logoutModal">
  <div class="mbox confirm">
    <div class="conf-ico">👋</div>
    <div class="conf-t">Log out?</div>
    <div class="conf-d">You will be signed out and redirected to the login page.</div>
    <div class="mft" style="justify-content:center;border:none;padding-top:0">
      <button class="btn btn-ghost" style="height:38px;font-size:12.5px" onclick="closeMov('logoutModal')">Stay</button>
      <button class="btn btn-dark" style="height:38px;font-size:12.5px" onclick="confirmLogout()">Yes, Logout</button>
    </div>
  </div>
</div>

<div class="toast" id="toast">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
  <span id="toastMsg"></span>
</div>

<!-- Django URLs for AJAX -->
<script>
const EDIT_COMPANY_URL = "{% url 'edit_company' 0 %}";
const DELETE_COMPANY_URL = "{% url 'delete_company' 0 %}";
</script>

<script>


  
/* ════ CSRF ════ */
function getCSRF(){
    return document.querySelector('#csrfForm input').value;
}

/* ════ MODAL HELPERS ════ */
function openMov(id){document.getElementById(id).classList.add('open')}
function closeMov(id){document.getElementById(id).classList.remove('open')}
document.querySelectorAll('.mov').forEach(function(o){
    o.addEventListener('click',function(e){if(e.target===o)o.classList.remove('open')});
});

/* ════ TOAST ════ */
var toastT;
function toast(msg,isErr){
    var t=document.getElementById('toast');
    t.className='toast'+(isErr?' toast-err':'');
    document.getElementById('toastMsg').textContent=msg;
    t.classList.add('show');
    clearTimeout(toastT);
    toastT=setTimeout(function(){t.classList.remove('show')},3200);
}

/* ════════════════════════════════════════
   SHARED: build view detail HTML for users
   id is passed from table button onclick
════════════════════════════════════════ */
function buildUserDetail(d,roleLabel,avatarClass){
    var pic=d.profile_url
        ?'<img src="'+d.profile_url+'" style="width:100%;height:100%;object-fit:cover;">'
        :'<span>'+(d.full_name||'?')[0]+'</span>';
    var roleBadge=({
        hr:'<span class="rbadge rb-hr" style="font-size:10px">HR Manager</span>',
        emp:'<span class="rbadge rb-emp" style="font-size:10px">Employee</span>'
    })[d.role]||'<span class="rbadge rb-stu" style="font-size:10px">Student / User</span>';
    return '<div class="vd-hero"><div class="vd-avi '+avatarClass+'">'+pic+'</div>'
        +'<div><div class="vd-name">'+(d.full_name||'—')+'</div>'
        +'<div class="vd-role">'+roleBadge+'</div></div></div>'
        +'<div class="vd-grid">'
        +'<div class="vd-cell"><div class="vd-key">Email</div><div class="vd-val">'+(d.Email||d.email||'—')+'</div></div>'
        +'<div class="vd-cell"><div class="vd-key">Phone</div><div class="vd-val">'+(d.phoneno||'—')+'</div></div>'
        +'<div class="vd-cell"><div class="vd-key">Department / Course</div><div class="vd-val">'+(d.course||'—')+'</div></div>'
        +'<div class="vd-cell"><div class="vd-key">Status</div><div class="vd-val"><span class="sbadge sb-active">Active</span></div></div>'
        +'<div class="vd-cell"><div class="vd-key">User ID</div><div class="vd-val">#'+d.id+'</div></div>'
        +'<div class="vd-cell"><div class="vd-key">Role</div><div class="vd-val">'+roleLabel+'</div></div>'
        +'</div>';
}

/* ════════════════════════════════════════
   HR MODALS
   View  → GET  /admin/get-user/<id>/
   Edit  → POST /admin/edit-user/<id>/    ← id in URL
   Delete→ via openDeleteModal()          ← id in URL
════════════════════════════════════════ */
function openHrView(id){
    /* id comes directly from {{ u.id }} in template */
    document.getElementById('hrViewBody').innerHTML='<div class="loader"></div>';
    document.getElementById('hrViewEditBtn').onclick=function(){closeMov('hrViewModal');openHrEdit(id)};
    openMov('hrViewModal');
    fetch('/admin/get-user/'+id+'/')
        .then(function(r){return r.json()})
        .then(function(d){document.getElementById('hrViewBody').innerHTML=buildUserDetail(d,'HR Manager','uavi-hr')})
        .catch(function(){document.getElementById('hrViewBody').innerHTML='<p style="padding:32px;text-align:center;color:var(--muted)">Could not load data.</p>'});
}

function openHrEdit(id){
    /* store id in hidden input so submitHrEdit() can read it */
    document.getElementById('hrEditId').value=id;
    openMov('hrEditModal');
    fetch('/admin/get-user/'+id+'/')
        .then(function(r){return r.json()})
        .then(function(d){
            document.getElementById('hrEditName').value  =d.full_name||'';
            document.getElementById('hrEditEmail').value =d.Email||d.email||'';
            document.getElementById('hrEditPhone').value =d.phoneno||'';
            document.getElementById('hrEditDept').value  =d.course||'';
        })
        .catch(function(){toast('Could not load user data',true)});
}

function submitHrEdit(){
    /* id read from hidden input — passed to URL /admin/edit-user/<id>/ */
    var id=document.getElementById('hrEditId').value;
    var body=new FormData();
    body.append('full_name',document.getElementById('hrEditName').value);
    body.append('Email',    document.getElementById('hrEditEmail').value);
    body.append('phoneno',  document.getElementById('hrEditPhone').value);
    body.append('course',   document.getElementById('hrEditDept').value);
    body.append('status',   document.getElementById('hrEditStatus').value);
    fetch('/admin/edit-user/'+id+'/',{method:'POST',headers:{'X-CSRFToken':getCSRF()},body:body})
        .then(function(r){return r.json()})
        .then(function(d){
            if(d.success){closeMov('hrEditModal');toast('HR Manager updated');location.reload()}
            else toast(d.message||'Update failed',true);
        })
        .catch(function(){window.location.href='/admin/edit-user/'+id+'/'});
}

/* ════════════════════════════════════════
   COMPANY MODALS
   View  → GET  /view_company/<id>/
   Edit  → POST /edit_company/<id>/       ← id in URL
   Delete→ POST /delete_company/<id>/     ← id in URL
════════════════════════════════════════ */
function openCompanyView(id){
    document.getElementById('companyViewBody').innerHTML='<div class="loader"></div>';
    document.getElementById('companyViewEditBtn').onclick=function(){closeMov('companyViewModal');openCompanyEdit(id)};
    openMov('companyViewModal');
    fetch('/view_company/'+id+'/')
        .then(function(r){return r.json()})
        .then(function(d){
            document.getElementById('companyViewBody').innerHTML=
                '<div class="vd-hero">'
                +'<div class="vd-avi uavi-emp" style="border-radius:10px;font-size:20px;font-weight:900">'+(d.company_name||'C')[0].toUpperCase()+'</div>'
                +'<div><div class="vd-name">'+(d.company_name||'—')+'</div>'
                +'<div class="vd-role"><span class="rbadge rb-emp" style="font-size:10px">Company</span></div></div></div>'
                +'<div class="vd-grid">'
                +'<div class="vd-cell"><div class="vd-key">Email</div><div class="vd-val">'+(d.email||'—')+'</div></div>'
                +'<div class="vd-cell"><div class="vd-key">Website</div><div class="vd-val"><a href="'+(d.website||'#')+'" target="_blank" style="color:#3b5de0;text-decoration:none">'+(d.website||'—')+'</a></div></div>'
                +'<div class="vd-cell"><div class="vd-key">Location</div><div class="vd-val">'+(d.location||'—')+'</div></div>'
                +'<div class="vd-cell"><div class="vd-key">Added On</div><div class="vd-val">'+(d.created||'—')+'</div></div>'
                +'</div>';
        })
        .catch(function(){document.getElementById('companyViewBody').innerHTML='<p style="padding:32px;text-align:center;color:var(--muted)">Could not load data.</p>'});
}

function openCompanyEdit(id){
    /* store id so submitCompanyEdit() knows which record to PATCH */
    document.getElementById('companyEditId').value=id;
    openMov('companyEditModal');
    fetch('/view_company/'+id+'/')
        .then(function(r){return r.json()})
        .then(function(d){
            document.getElementById('companyEditName').value    =d.company_name||'';
            document.getElementById('companyEditEmail').value   =d.email||'';
            document.getElementById('companyEditWebsite').value =d.website||'';
            document.getElementById('companyEditLocation').value=d.location||'';
        })
        .catch(function(){toast('Could not load company data',true)});
}

function submitCompanyEdit(){
    const id = document.getElementById('companyEditId').value;

    const formData = new FormData();
    formData.append('company_name', document.getElementById('companyEditName').value);
    formData.append('email', document.getElementById('companyEditEmail').value);
    formData.append('website', document.getElementById('companyEditWebsite').value);
    formData.append('location', document.getElementById('companyEditLocation').value);

    const url = EDIT_COMPANY_URL.replace('/0/','/'+id+'/');

    fetch(url,{
        method:'POST',
        headers:{ 'X-CSRFToken': getCSRF() },
        body:formData
    })
    .then(res=>res.json())
    .then(data=>{
        if(data.success){
            updateCompanyRow(data);   // ⭐ magic happens here
            closeMov('companyEditModal');
            toast("Company updated successfully");
        }else{
            toast("Update failed", true);
        }
    })
}

function updateCompanyRow(data){
    // find table row using company id
    const row = document.querySelector(`button[onclick="openCompanyEdit(${data.id})"]`).closest("tr");

    row.children[1].querySelector(".uname").innerText = data.company_name;
    row.children[2].innerText = data.email;
    row.children[3].innerHTML = `<a href="${data.website}" target="_blank" style="color:#3b5de0;text-decoration:none">${data.website}</a>`;
    row.children[4].innerText = data.location;
}

/* ════════════════════════════════════════
   STUDENT MODALS
   Same endpoints as HR (/admin/get-user/ and /admin/edit-user/)
════════════════════════════════════════ */
function openStudentView(id){
    document.getElementById('studentViewBody').innerHTML='<div class="loader"></div>';
    document.getElementById('studentViewEditBtn').onclick=function(){closeMov('studentViewModal');openStudentEdit(id)};
    openMov('studentViewModal');
    fetch('/admin/get-user/'+id+'/')
        .then(function(r){return r.json()})
        .then(function(d){document.getElementById('studentViewBody').innerHTML=buildUserDetail(d,'Student / User','uavi-stu')})
        .catch(function(){document.getElementById('studentViewBody').innerHTML='<p style="padding:32px;text-align:center;color:var(--muted)">Could not load data.</p>'});
}

function openStudentEdit(id){
    /* store id in hidden input */
    document.getElementById('studentEditId').value=id;
    openMov('studentEditModal');
    fetch('/admin/get-user/'+id+'/')
        .then(function(r){return r.json()})
        .then(function(d){
            document.getElementById('studentEditName').value  =d.full_name||'';
            document.getElementById('studentEditEmail').value =d.Email||d.email||'';
            document.getElementById('studentEditPhone').value =d.phoneno||'';
            document.getElementById('studentEditCourse').value=d.course||'';
        })
        .catch(function(){toast('Could not load student data',true)});
}

function submitStudentEdit(){
    /* id read from hidden input → /admin/edit-user/<id>/ */
    var id=document.getElementById('studentEditId').value;
    var body=new FormData();
    body.append('full_name',document.getElementById('studentEditName').value);
    body.append('Email',    document.getElementById('studentEditEmail').value);
    body.append('phoneno',  document.getElementById('studentEditPhone').value);
    body.append('course',   document.getElementById('studentEditCourse').value);
    body.append('status',   document.getElementById('studentEditStatus').value);
    fetch('/admin/edit-user/'+id+'/',{method:'POST',headers:{'X-CSRFToken':getCSRF()},body:body})
        .then(function(r){return r.json()})
        .then(function(d){
            if(d.success){closeMov('studentEditModal');toast('Student updated');location.reload()}
            else toast(d.message||'Update failed',true);
        })
        .catch(function(){window.location.href='/admin/edit-user/'+id+'/'});
}

/* ════════════════════════════════════════
   SHARED DELETE MODAL
   type='user'    → GET  /admin/delete-user/<id>/   (Django redirect view)
   type='company' → POST /delete_company/<id>/      (AJAX)
   id is passed directly from each table row's onclick="{{ u.id }}"
════════════════════════════════════════ */
function openDeleteModal(type,id,name){
    var icons ={user:'🗑️',company:'🏢'};
    var titles={user:'Delete User?',company:'Remove Company?'};

    document.getElementById('deleteIcon').textContent =icons[type]||'🗑️';
    document.getElementById('deleteTitle').textContent=titles[type]||'Delete?';
    document.getElementById('deleteDesc').textContent ='"'+name+'" will be permanently removed and cannot be restored.';

    document.getElementById('deleteConfirmBtn').onclick=function(){

        /* ================= COMPANY DELETE AJAX ================= */
        if(type==='company'){

            const url = DELETE_COMPANY_URL.replace('/0/','/'+id+'/');

            fetch(url,{
                method:'POST',
                headers:{ 'X-CSRFToken': getCSRF() }
            })
            .then(res=>res.json())
            .then(data=>{
                if(data.success){

                    removeCompanyRow(id); 
                    closeMov('deleteModal');
                    toast('Company removed successfully');

                }else{
                    toast('Delete failed', true);
                }
            })
            .catch(()=>toast('Server error',true));

        }

        /* ================= USER DELETE NORMAL ================= */
        else{
            window.location.href='/admin/delete-user/'+id+'/';
        }
    };

    openMov('deleteModal');
}

function removeCompanyRow(id){
    const btn = document.querySelector(`button[onclick="openDeleteModal('company',${id}`);
    if(!btn) return;

    const row = btn.closest("tr");
    if(row) row.remove();
}

/* ════ ADD COMPANY ════ */
function openCompanyModal(){document.getElementById('companyModal').style.display='flex'}
function closeCompanyModal(){document.getElementById('companyModal').style.display='none'}
document.getElementById('companyForm').addEventListener('submit',function(e){
    e.preventDefault();
    fetch('/add_company/',{method:'POST',headers:{'X-CSRFToken':getCSRF()},body:new FormData(this)})
        .then(function(r){return r.json()})
        .then(function(d){
            if(d.success){toast('Company added');closeCompanyModal();this.reset();location.reload()}
            else toast('Error adding company',true);
        }.bind(this))
        .catch(function(){toast('Network error',true)});
});

/* ════ PAGE NAV ════ */
function showPage(name,btn){
    document.querySelectorAll('.page').forEach(function(p){p.classList.remove('active')});
    document.querySelectorAll('.nav-item').forEach(function(n){n.classList.remove('active')});
    document.querySelectorAll('.popup-item').forEach(function(p){p.classList.remove('active-page')});
    var pg=document.getElementById('page-'+name);if(pg)pg.classList.add('active');
    if(btn)btn.classList.add('active');
    if(window.innerWidth<=768)closeSB();
    window.scrollTo(0,0);
}
function markPopupActive(name){
    document.querySelectorAll('.popup-item').forEach(function(p){p.classList.remove('active-page')});
    var map={profile:0,password:1};
    var items=document.querySelectorAll('.popup-item');
    if(map[name]!==undefined&&items[map[name]])items[map[name]].classList.add('active-page');
}

/* ════ SIDEBAR ════ */
function toggleSB(){document.getElementById('sidebar').classList.toggle('open');document.getElementById('mobOv').classList.toggle('open')}
function closeSB(){document.getElementById('sidebar').classList.remove('open');document.getElementById('mobOv').classList.remove('open')}

/* ════ ADD USER ════ */
function openAdd(rp){
    document.getElementById('modal-title').textContent='Add User';
    document.getElementById('saveBtn').textContent='Save User';
    ['fFirst','fLast','fEmail','fDept'].forEach(function(id){document.getElementById(id).value=''});
    document.getElementById('fRole').value=rp||'Student';
    document.getElementById('fStatus').value='Active';
    openMov('addModal');
}
function saveUser(){toast('Connect saveUser() to your backend');closeMov('addModal')}

/* ════ PROFILE ════ */
function saveProfile(){toast('Profile saved successfully')}

/* ════ PASSWORD ════ */
function checkPwReqs(){
    var v=document.getElementById('pwNew').value;
    function set(id,ok){
        var el=document.getElementById(id);
        el.style.color=ok?'var(--black)':'var(--muted)';
        el.querySelector('svg').innerHTML=ok
            ?'<polyline points="20 6 9 17 4 12" stroke-width="2.5"/>'
            :'<circle cx="12" cy="12" r="9" stroke-width="2.5"/>';
    }
    set('req-len',v.length>=8);
    set('req-upper',/[A-Z]/.test(v));
    set('req-special',/[^a-zA-Z0-9]/.test(v));
}
function resetPwReqs(){
    ['req-len','req-upper','req-special'].forEach(function(id){
        var el=document.getElementById(id);
        el.style.color='var(--muted)';
        el.querySelector('svg').innerHTML='<circle cx="12" cy="12" r="9" stroke-width="2.5"/>';
    });
}
function handlePwSubmit(e){
    e.preventDefault();
    var np=document.getElementById('pwNew').value;
    var cf=document.getElementById('pwConfirm').value;
    var mb=document.getElementById('pwMsg');
    if(np!==cf){mb.innerHTML='<div style="background:#fff0f0;color:#b91c1c;padding:13px 26px;font-size:13px;border-bottom:1px solid var(--ghost)">Passwords do not match.</div>';return}
    if(np.length<8){mb.innerHTML='<div style="background:#fff0f0;color:#b91c1c;padding:13px 26px;font-size:13px;border-bottom:1px solid var(--ghost)">Password must be at least 8 characters.</div>';return}
    mb.innerHTML='<div style="background:#f0fdf4;color:#15803d;padding:13px 26px;font-size:13px;border-bottom:1px solid var(--ghost)">✓ Password updated successfully.</div>';
    document.getElementById('pwForm').reset();resetPwReqs();toast('Password updated');
}

/* ════ LOGOUT ════ */
function handleLogout(){openMov('logoutModal')}
function confirmLogout(){closeMov('logoutModal');toast('Logging out…');setTimeout(function(){window.location.href='/login/'},1200)}

/* ════ INIT ════ */
document.addEventListener('DOMContentLoaded',function(){
    var d=new Date();
    var days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
    var mos=['January','February','March','April','May','June','July','August','September','October','November','December'];
    function suf(n){return n+(n%10===1&&n!==11?'st':n%10===2&&n!==12?'nd':n%10===3&&n!==13?'rd':'th')}
    var ds=days[d.getDay()]+', '+mos[d.getMonth()]+' '+suf(d.getDate())+' · All systems operational';
    ['dash-date','hr-date','emp-date','stu-date'].forEach(function(id){
        var el=document.getElementById(id);if(el)el.textContent=ds;
    });
});
</script>
</body>
</html>